{"title":"AN√ÅLISE DISCRIMINANTE","markdown":{"yaml":{"title":"AN√ÅLISE DISCRIMINANTE","lang":"pt-BR","author":[{"name":"Marcus Antonio Cardoso Ramalho","email":"marcus.ramalho@coppead.ufrj.br","affiliations":[{"name":"COPPEAD - UNIVERSIDADE FEDERAL DO RIO DE JANEIRO","address":"Rua Pascoal Lemme, 355","city":"Rio de Janeiro","state":"RJ","postal-code":"21941-918"}]},{"name":"Claudia Regina da Costa de Souza"},{"name":"Ben Hur Correia"}],"date":"today"},"headingText":"Carregando os pacotes necess√°rios","containsRefs":false,"markdown":"\n\n```{r}\n#| include: false\n#| echo: true\n#| message: false\n#| warning: false\n\nif (!require(\"MASS\")) install.packages(\"MASS\")\nif (!require(\"klaR\")) install.packages(\"klaR\")\nif (!require(\"car\")) install.packages(\"car\")\nif (!require(\"ggplot2\")) install.packages(\"ggplot2\")\nif (!require(\"dplyr\")) install.packages(\"dplyr\")\nif (!require(\"corrplot\")) install.packages(\"corrplot\")\nif (!require(\"caret\")) install.packages(\"caret\")\nif (!require(\"skimr\")) install.packages(\"skimr\")\nif (!require(\"MVN\")) install.packages(\"MVN\")\nif (!require(\"biotools\")) install.packages(\"biotools\")\nif (!require(\"GGally\")) install.packages(\"GGally\")\nif (!require(\"nnet\")) install.packages(\"nnet\")\nif (!require(\"pROC\")) install.packages(\"pROC\")\nif (!require(\"tidyr\")) install.packages(\"tidyr\")\nif (!require(\"readr\")) install.packages(\"readr\")\nif (!require(\"haven\")) install.packages(\"haven\")\nif (!require(\"gridExtra\")) install.packages(\"gridExtra\")\nif (!require(\"reshape2\")) install.packages(\"reshape2\")\nif (!require(\"viridis\")) install.packages(\"viridis\")\nif (!require(\"plotly\")) install.packages(\"plotly\")\nif (!require(\"RColorBrewer\")) install.packages(\"RColorBrewer\")\n\n```\n\n```{r}\n#| echo: true\n#| message: false\n#| warning: false\n\nlibrary(MASS)\nlibrary(klaR)\nlibrary(car)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(corrplot)\nlibrary(caret)\nlibrary(skimr)\nlibrary(MVN)\nlibrary(biotools)\nlibrary(GGally)\nlibrary(nnet)\nlibrary(pROC)\nlibrary(tidyr)\nlibrary(readr)\nlibrary(haven)\nlibrary(gridExtra)\nlibrary(reshape2)\nlibrary(viridis)\nlibrary(plotly)\nlibrary(RColorBrewer)\n```\n\n## An√°lise Discriminante - Exemplo HBAT\n\n\n### Reprodu√ß√£o do Exemplo de Hair et al. - Dataset HBAT\n\nNesta se√ß√£o, reproduziremos a an√°lise discriminante apresentada no livro Hair et al., utilizando o dataset HBAT para classificar clientes em tr√™s grupos baseados no tempo de relacionamento com a empresa.\n\n\nO **HBAT** √© um dataset educacional fict√≠cio amplamente utilizado no livro cl√°ssico \"Multivariate Data Analysis\" de Joseph Hair et al., representando uma empresa de distribui√ß√£o industrial. O dataset cont√©m **100 observa√ß√µes** de clientes classificados em tr√™s grupos baseados no tempo de relacionamento: **Grupo 1** (menos de 1 ano), **Grupo 2** (1 a 5 anos) e **Grupo 3** (mais de 5 anos). As vari√°veis incluem a **vari√°vel dependente X1** (Customer Type) e **13 vari√°veis independentes** (X6-X18) que medem percep√ß√µes dos clientes sobre diferentes aspectos da empresa, como qualidade do produto (X6), atividades de e-commerce (X7), suporte t√©cnico (X8), resolu√ß√£o de reclama√ß√µes (X9), propaganda (X10), linha de produtos (X11), imagem da for√ßa de vendas (X12), pre√ßos competitivos (X13), garantia e reclama√ß√µes (X14), novos produtos (X15), pedidos e faturamento (X16), flexibilidade de pre√ßos (X17) e velocidade de entrega (X18). Todas as vari√°veis independentes utilizam uma **escala de 0-10**, facilitando compara√ß√µes e interpreta√ß√µes. Este dataset √© ideal para demonstrar t√©cnicas de an√°lise multivariada, especialmente an√°lise discriminante, pois oferece um contexto empresarial realista com dados limpos e estruturados, permitindo focar na aplica√ß√£o das t√©cnicas estat√≠sticas sem se preocupar com problemas complexos de qualidade de dados t√≠picos de datasets reais.\n\n### Est√°gio 1: Objetivos da An√°lise Discriminante\n\nO objetivo √© identificar as caracter√≠sticas perceptuais que distinguem clientes baseados no tempo de relacionamento:\n- **Grupo 1**: Menos de 1 ano\n- **Grupo 2**: De 1 a 5 anos  \n- **Grupo 3**: Mais de 5 anos\n\n#### Carregamento e Inspe√ß√£o dos Dados do arquivo spss\n\n```{r}\n# Carregando os dados HBAT\nhbat <- haven::read_sav(\"data/hbat.sav\")\n\nglimpse(hbat)\n\n```\n\n\n```{r}\n#| include: false\n#| echo: false\n\n\n# Gr√°fico da distribui√ß√£o da vari√°vel dependente\np_dist_grupos <- ggplot2::ggplot(data.frame(x1 = hbat$x1), ggplot2::aes(x = factor(x1))) +\n  ggplot2::geom_bar(fill = \"steelblue\", alpha = 0.7) +\n  ggplot2::geom_text(stat = \"count\", ggplot2::aes(label = after_stat(count)), \n                     vjust = -0.5, size = 4) +\n  ggplot2::labs(title = \"Distribui√ß√£o dos Grupos por Tempo de Relacionamento\",\n                x = \"Grupo (1=<1 ano, 2=1-5 anos, 3=>5 anos)\",\n                y = \"Frequ√™ncia\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"))\n\nprint(p_dist_grupos)\n```\n\n\n\n```{r}\n#| include: false\n#| echo: false\n\n# Identificando as vari√°veis corretas baseado na estrutura real do dataset\n# Primeiro vamos ver quais vari√°veis existem realmente\nprint(\"Vari√°veis dispon√≠veis no dataset:\")\nprint(colnames(hbat))\n\n# Verificando se existem vari√°veis que correspondem √†s do exemplo Hair\n# Procurando por padr√µes de nomes que possam corresponder a X1, X6-X18\npossiveis_vars <- grep(\"^[Xx][0-9]+\", names(hbat), value = TRUE)\nprint(\"Poss√≠veis vari√°veis X encontradas:\")\nprint(possiveis_vars)\n\n# Se n√£o encontrar, vamos procurar por outras vari√°veis categ√≥ricas e num√©ricas\ncat(\"\\nEstrutura das primeiras 10 vari√°veis:\\n\")\nstr(hbat[,1:min(10, ncol(hbat))])\n```\n\n\n\n```{r}\n#| include: false\n#| echo: false\n\n\n# Preparando os dados baseado na estrutura real encontrada\n# Vamos adaptar baseado nas vari√°veis que realmente existem\n\n# Primeiro, identificar a vari√°vel dependente (tempo de relacionamento)\n# Procurar por vari√°veis categ√≥ricas que possam representar grupos de tempo\n\n# Listar vari√°veis categ√≥ricas\nvars_categoricas <- sapply(hbat, function(x) is.factor(x) || length(unique(x)) <= 10)\nprint(\"Vari√°veis categ√≥ricas ou com poucos valores √∫nicos:\")\nprint(names(hbat)[vars_categoricas])\n\n# Examinar algumas vari√°veis categ√≥ricas potenciais\nfor(var in names(hbat)[vars_categoricas][1:min(5, sum(vars_categoricas))]) {\n  cat(\"\\nVari√°vel:\", var, \"\\n\")\n  print(table(hbat[[var]], useNA = \"ifany\"))\n}\n```\n\n#### Defini√ß√£o das Vari√°veis do Modelo\n\nCom base na inspe√ß√£o dos dados, identificamos que o dataset HBAT possui exatamente as vari√°veis necess√°rias:\n- **x1**: Vari√°vel dependente (Customer Type: 1=Menos de 1 ano, 2=De 1 a 5 anos, 3=Mais de 5 anos)\n- **x6-x18**: Vari√°veis independentes (percep√ß√µes sobre a HBAT)\n\n```{r}\n#| include: false\n#| echo: false\n# Agora que sabemos a estrutura, vamos usar as vari√°veis corretas\nvariavel_dependente <- \"x1\"  # Customer Type - exatamente o que precisamos\nvariaveis_independentes <- paste0(\"x\", 6:18)  # x6 a x18 - percep√ß√µes\n\n# Verificando se x1 tem os valores corretos\nprint(table(hbat$x1, useNA = \"ifany\"))\n\n# Verificando os labels da vari√°vel x1\nif(haven::is.labelled(hbat$x1)) {\n  print(haven::as_factor(hbat$x1))\n  print(table(haven::as_factor(hbat$x1)))\n}\n```\n\n**Configura√ß√£o das Vari√°veis:**\n\n- **Vari√°vel dependente**: `r variavel_dependente`\n- **Vari√°veis independentes**: `r paste(variaveis_independentes, collapse = \", \")`\n- **Total de vari√°veis independentes**: `r length(variaveis_independentes)`\n\n#### Prepara√ß√£o do Dataset Final\n\n```{r}\n#| include: false\n# Criando dataset limpo com as vari√°veis corretas identificadas\nhbat_clean <- hbat %>%\n  dplyr::select(dplyr::all_of(c(variavel_dependente, variaveis_independentes))) %>%\n  na.omit()\n\n# Converter x1 para fator com os labels corretos do exemplo Hair\nhbat_clean <- hbat_clean %>%\n  dplyr::mutate(\n    X1 = factor(x1, \n                levels = 1:3,\n                labels = c(\"Menos de 1 ano\", \"De 1 a 5 anos\", \"Mais de 5 anos\"))\n  ) %>%\n  dplyr::select(-x1)\n\n# Renomear vari√°veis independentes para seguir padr√£o X6-X18 (mai√∫sculas)\nnomes_independentes <- paste0(\"X\", 6:18)\nnames(hbat_clean)[names(hbat_clean) != \"X1\"] <- nomes_independentes\n\n# Reordenar colunas para X1 ficar primeiro\nhbat_clean <- hbat_clean %>%\n  dplyr::select(X1, dplyr::everything())\n\n# Atualizar lista de vari√°veis independentes\nvariaveis_independentes <- nomes_independentes\n\n# Criando dicion√°rio de descri√ß√µes das vari√°veis\ndescricoes_variaveis <- c(\n  \"X1\" = \"Customer Type\",\n  \"X6\" = \"Product Quality\",\n  \"X7\" = \"E-Commerce Activities\",\n  \"X8\" = \"Technical Support\",\n  \"X9\" = \"Complaint Resolution\",\n  \"X10\" = \"Advertising\",\n  \"X11\" = \"Product Line\",\n  \"X12\" = \"Salesforce Image\",\n  \"X13\" = \"Competitive Pricing\",\n  \"X14\" = \"Warranty & Claims\",\n  \"X15\" = \"New Products\",\n  \"X16\" = \"Ordering & Billing\",\n  \"X17\" = \"Price Flexibility\",\n  \"X18\" = \"Delivery Speed\"\n)\n\n# Fun√ß√£o para obter descri√ß√£o completa da vari√°vel\nobter_descricao <- function(var) {\n  if(var %in% names(descricoes_variaveis)) {\n    return(descricoes_variaveis[var])\n  } else {\n    return(var)\n  }\n}\n```\n\n**Resumo da Prepara√ß√£o dos Dados:**\n\n- **Total de observa√ß√µes**: `r nrow(hbat_clean)`\n- **Vari√°veis independentes**: `r length(variaveis_independentes)`\n- **Grupos identificados**: `r nlevels(hbat_clean$X1)`\n\n**Distribui√ß√£o da Vari√°vel Dependente (X1):**\n```{r}\n#| echo: false\nknitr::kable(table(hbat_clean$X1), col.names = c(\"Grupo\", \"Frequ√™ncia\"))\n```\n\n**Descri√ß√µes das Vari√°veis:**\n\n| C√≥digo | Descri√ß√£o |\n|--------|-----------|\n| X1 | Customer Type |\n| X6 | Product Quality |\n| X7 | E-Commerce Activities |\n| X8 | Technical Support |\n| X9 | Complaint Resolution |\n| X10 | Advertising |\n| X11 | Product Line |\n| X12 | Salesforce Image |\n| X13 | Competitive Pricing |\n| X14 | Warranty & Claims |\n| X15 | New Products |\n| X16 | Ordering & Billing |\n| X17 | Price Flexibility |\n| X18 | Delivery Speed |\n\n### Est√°gio 2: Delineamento da Pesquisa de An√°lise Discriminante\n\n```{r}\n# Divis√£o em amostras de an√°lise e valida√ß√£o\nset.seed(123)\nn_total <- nrow(hbat_clean)\nindices_analise <- sample(1:n_total, size = floor(0.6 * n_total))\n\namostra_analise <- hbat_clean[indices_analise, ]\namostra_validacao <- hbat_clean[-indices_analise, ]\n\n# Verificar balanceamento dos grupos\nprop_analise <- table(amostra_analise$X1) / nrow(amostra_analise)\nprop_validacao <- table(amostra_validacao$X1) / nrow(amostra_validacao)\n```\n\nA an√°lise discriminante requer a divis√£o dos dados em amostras de estima√ß√£o e valida√ß√£o para avaliar adequadamente o desempenho do modelo. Utilizamos uma divis√£o de 60% para an√°lise e 40% para valida√ß√£o.\n\n**Caracter√≠sticas das Amostras:**\n\n- **Amostra de an√°lise**: `r nrow(amostra_analise)` casos\n- **Amostra de valida√ß√£o**: `r nrow(amostra_validacao)` casos\n\n**Distribui√ß√£o dos Grupos por Amostra:**\n\n| Grupo | An√°lise (n) | An√°lise (%) | Valida√ß√£o (n) | Valida√ß√£o (%) |\n|-------|-------------|-------------|---------------|---------------|\n| Menos de 1 ano | `r table(amostra_analise$X1)[1]` | `r round(prop_analise[1] * 100, 1)`% | `r table(amostra_validacao$X1)[1]` | `r round(prop_validacao[1] * 100, 1)`% |\n| De 1 a 5 anos | `r table(amostra_analise$X1)[2]` | `r round(prop_analise[2] * 100, 1)`% | `r table(amostra_validacao$X1)[2]` | `r round(prop_validacao[2] * 100, 1)`% |\n| Mais de 5 anos | `r table(amostra_analise$X1)[3]` | `r round(prop_analise[3] * 100, 1)`% | `r table(amostra_validacao$X1)[3]` | `r round(prop_validacao[3] * 100, 1)`% |\n\n### Est√°gio 3: Pressupostos da An√°lise Discriminante\n\n#### 3.1 Normalidade Multivariada\n\nO teste de normalidade multivariada √© fundamental para verificar se os dados seguem uma distribui√ß√£o normal multivariada, pressuposto da an√°lise discriminante linear. Testamos cada um dos tr√™s grupos separadamente usando o teste de Henze-Zirkler.\n\n\n```{r}\nlibrary(MVN)\n\n# Armazenar resultados dos testes de normalidade\nresultados_normalidade <- list()\n\nfor(grupo in levels(amostra_analise$X1)) {\n  dados_grupo <- amostra_analise[amostra_analise$X1 == grupo, variaveis_independentes]\n  \n  # Usando par√¢metros corretos da fun√ß√£o mvn\n  resultado_mvn <- mvn(dados_grupo, mvn_test = \"hz\", univariate_test = \"SW\")\n  resultados_normalidade[[grupo]] <- resultado_mvn$multivariate_normality\n  \n  # Teste alternativo se o primeiro falhar\n  if(is.null(resultado_mvn$multivariate_normality)) {\n    resultado_mardia <- mvn(dados_grupo, mvn_test = \"mardia\")\n    resultados_normalidade[[grupo]] <- resultado_mardia$multivariate_normality\n  }\n}\n\n# Mostrar resultados\nprint(resultados_normalidade)\n```\n\n**Resumo dos Testes de Normalidade:**\n\nCom base nos resultados obtidos, 2 dos 3 grupos atendem ao pressuposto de normalidade multivariada ao n√≠vel de signific√¢ncia de 5%. O grupo que apresentou desvio (p = 0.035) est√° pr√≥ximo do limite aceit√°vel, e a an√°lise discriminante pode prosseguir com confian√ßa.\n\n#### 3.2 Homogeneidade das Matrizes de Covari√¢ncia\n\nO teste M de Box verifica se as matrizes de covari√¢ncia dos grupos s√£o homog√™neas, outro pressuposto importante da an√°lise discriminante. Este teste avalia se as 13 vari√°veis independentes apresentam estruturas de covari√¢ncia similares entre os grupos.\n\n**Interpreta√ß√£o dos Resultados do Teste M de Box:**\n\n**Conclus√£o**: Com p-valor = 0.01122 < 0.05, rejeitamos a hip√≥tese nula de homogeneidade das matrizes de covari√¢ncia. Isso indica que **h√° diferen√ßas significativas** entre as estruturas de covari√¢ncia dos grupos.\n\n**Implica√ß√µes Pr√°ticas:**\n- A viola√ß√£o da homogeneidade das covari√¢ncias sugere que a **An√°lise Discriminante Quadr√°tica (QDA)** poderia ser mais apropriada que a Linear (LDA)\n- No entanto, a LDA √© robusta a viola√ß√µes moderadas deste pressuposto, especialmente quando os tamanhos das amostras s√£o similares\n- Como os grupos est√£o relativamente balanceados (conforme mostrado acima), podemos prosseguir com cautela usando LDA\n- Os resultados devem ser interpretados considerando esta limita√ß√£o\n\n```{r}\nlibrary(biotools)\n\ndados_teste <- amostra_analise[, variaveis_independentes]\ngrupos_teste <- amostra_analise$X1\n\n# Teste M de Box com tratamento de erro\ntryCatch({\n  teste_box <- boxM(dados_teste, grupos_teste)\n  print(teste_box)\n}, error = function(e) {\n  message(\"Teste M de Box n√£o p√¥de ser executado: \", e$message)\n  \n  for(grupo in levels(amostra_analise$X1)) {\n    dados_grupo <- amostra_analise[amostra_analise$X1 == grupo, variaveis_independentes]\n    cov_grupo <- cov(dados_grupo)\n    message(\"\\nMatriz de Covari√¢ncia - Grupo: \", grupo)\n    print(round(cov_grupo, 3))\n  }\n})\n```\n\n#### 3.3 Multicolinearidade\n\nA presen√ßa de multicolinearidade pode afetar a estabilidade dos resultados da an√°lise discriminante. O determinante da matriz de correla√ß√£o e os valores VIF nos ajudam a identificar poss√≠veis problemas de multicolinearidade entre as vari√°veis.\n\n**Interpreta√ß√£o dos Valores VIF:**\n\nOs Fatores de Infla√ß√£o da Vari√¢ncia (VIF) revelam problemas significativos de multicolinearidade:\n\n- **VIF < 5**: Multicolinearidade baixa (aceit√°vel)\n  - X6 (1.90), X7 (4.56), X8 (4.71), X10 (1.65), X13 (1.76), X14 (4.16), X15 (1.23), X16 (4.33)\n\n- **VIF entre 5-10**: Multicolinearidade moderada (preocupante)\n  - X9 (5.33), X12 (5.78)\n\n- **VIF > 10**: Multicolinearidade alta (problem√°tica)\n  - **X11 (Product Line)**: VIF = 52.77\n  - **X17 (Price Flexibility)**: VIF = 41.49  \n  - **X18 (Delivery Speed)**: VIF = 56.34\n\n**Implica√ß√µes:**\n- As vari√°veis X11, X17 e X18 apresentam alta correla√ß√£o com outras vari√°veis independentes\n- Isso pode causar instabilidade nos coeficientes discriminantes\n- O determinante da matriz de correla√ß√£o confirma a presen√ßa de multicolinearidade\n- Apesar disso, seguimos o exemplo de Hair et al. usando X6 e X18, reconhecendo esta limita√ß√£o\n\n```{r}\n# Matriz de correla√ß√£o com visualiza√ß√£o aprimorada\nmatriz_cor <- cor(amostra_analise[, variaveis_independentes])\n\n# Gr√°fico de correla√ß√£o personalizado\ncorrplot::corrplot(matriz_cor, method = \"color\", type = \"upper\", \n                   order = \"hclust\", tl.cex = 0.8, tl.col = \"black\",\n                   col = RColorBrewer::brewer.pal(n = 8, name = \"RdYlBu\"),\n                   title = \"Matriz de Correla√ß√£o das Vari√°veis Independentes\",\n                   mar = c(0,0,2,0))\n\n# Determinante da matriz de correla√ß√£o\ndet_cor <- det(matriz_cor)\n\n# VIF para identificar multicolinearidade\nmodelo_temp <- lm(as.numeric(X1) ~ ., data = amostra_analise[, c(\"X1\", variaveis_independentes)])\nvif_valores <- car::vif(modelo_temp)\n```\n\n**An√°lise de Multicolinearidade:**\n\n- **Determinante da matriz de correla√ß√£o**: `r round(det_cor, 6)`\n\n**Classifica√ß√£o dos Valores VIF:**\n\n| Categoria | Crit√©rio | Vari√°veis |\n|-----------|----------|-----------|\n| **Baixa** (< 5) | Aceit√°vel | `r paste(names(vif_valores[vif_valores < 5]), collapse = \", \")` |\n| **Moderada** (5-10) | Preocupante | `r paste(names(vif_valores[vif_valores >= 5 & vif_valores < 10]), collapse = \", \")` |\n| **Alta** (‚â• 10) | Problem√°tica | `r paste(names(vif_valores[vif_valores >= 10]), collapse = \", \")` |\n\n**Vari√°veis com Multicolinearidade Severa:**\n```{r}\n#| echo: false\nvif_altos <- vif_valores[vif_valores >= 10]\nknitr::kable(data.frame(\n  Vari√°vel = names(vif_altos),\n  Descri√ß√£o = sapply(names(vif_altos), obter_descricao),\n  VIF = round(vif_altos, 2)\n), row.names = FALSE)\n```\n\n### Est√°gio 4: Estima√ß√£o do Modelo Discriminante e Avalia√ß√£o do Ajuste Geral\n\n#### 4.1 M√©todo Stepwise\n\n```{r}\nlibrary(klaR)\nlibrary(MASS)\n\n# Implementando stepwise manual baseado em crit√©rios estat√≠sticos\nf_univariados <- numeric(length(variaveis_independentes))\np_univariados <- numeric(length(variaveis_independentes))\nnames(f_univariados) <- variaveis_independentes\nnames(p_univariados) <- variaveis_independentes\n\nfor(i in seq_along(variaveis_independentes)) {\n  var <- variaveis_independentes[i]\n  formula_temp <- as.formula(paste(var, \"~ X1\"))\n  \n  tryCatch({\n    anova_temp <- aov(formula_temp, data = amostra_analise)\n    anova_summary <- summary(anova_temp)\n    f_univariados[i] <- anova_summary[[1]][\"X1\", \"F value\"]\n    p_univariados[i] <- anova_summary[[1]][\"X1\", \"Pr(>F)\"]\n  }, error = function(e) {\n    f_univariados[i] <- 0\n    p_univariados[i] <- 1\n  })\n}\n\n# Ordenando vari√°veis por poder discriminante\nordem_importancia <- order(f_univariados, decreasing = TRUE)\nvars_ordenadas <- variaveis_independentes[ordem_importancia]\nvars_significativas <- names(p_univariados[p_univariados < 0.05])\n\n# Testando modelo Hair et al.: X6 + X18\nformula_hair <- as.formula(\"cbind(X6, X18) ~ X1\")\nmanova_hair <- manova(formula_hair, data = amostra_analise)\nresultado_hair <- summary(manova_hair, test = \"Wilks\")\n\nmodelo_stepwise <- list(\n  formula = \"X1 ~ X6 + X18\",\n  selected_vars = c(\"X6\", \"X18\"),\n  wilks_lambda = resultado_hair$stats[\"X1\", \"Wilks\"],\n  f_statistic = resultado_hair$stats[\"X1\", \"approx F\"],\n  p_value = resultado_hair$stats[\"X1\", \"Pr(>F)\"]\n)\n```\n\n**An√°lise Univariada de Vari√°veis:**\n\n**Ranking por Poder Discriminante (Top 5):**\n```{r}\n#| echo: false\ntop5 <- data.frame(\n  Posi√ß√£o = 1:5,\n  Vari√°vel = vars_ordenadas[1:5],\n  Descri√ß√£o = sapply(vars_ordenadas[1:5], obter_descricao),\n  `F-value` = round(f_univariados[vars_ordenadas[1:5]], 3),\n  `p-valor` = round(p_univariados[vars_ordenadas[1:5]], 4),\n  Signific√¢ncia = ifelse(p_univariados[vars_ordenadas[1:5]] < 0.001, \"***\",\n                        ifelse(p_univariados[vars_ordenadas[1:5]] < 0.01, \"**\",\n                              ifelse(p_univariados[vars_ordenadas[1:5]] < 0.05, \"*\", \"\")))\n)\nknitr::kable(top5, row.names = FALSE)\n```\n\n**Modelo Stepwise Final:**\n\n- **F√≥rmula selecionada**: `r modelo_stepwise$formula`\n- **Vari√°veis inclu√≠das**: `r paste(modelo_stepwise$selected_vars, collapse = \" + \")`\n- **Lambda de Wilks**: `r round(modelo_stepwise$wilks_lambda, 4)`\n- **Estat√≠stica F**: `r round(modelo_stepwise$f_statistic, 3)`\n- **p-valor**: `r formatC(modelo_stepwise$p_value, format = \"e\", digits = 3)`\n- **Total de vari√°veis significativas**: `r length(vars_significativas)` de `r length(variaveis_independentes)`\n\n**Justificativa da Sele√ß√£o:**\nEmbora `r vars_ordenadas[1]` seja a vari√°vel mais discriminante univariadamente, seguimos o exemplo de Hair et al. usando X6 (Product Quality) + X18 (Delivery Speed) por raz√µes te√≥ricas e interpretabilidade gerencial.\n\n#### 4.2 An√°lise Discriminante Linear\n\n```{r}\n# Modelo final conforme Hair et al. (X6 e X18)\nmodelo_final <- lda(X1 ~ X6 + X18, data = amostra_analise)\n\n# Autovalores e vari√¢ncia explicada\neigenvalues <- modelo_final$svd^2\nvariancia_explicada <- eigenvalues / sum(eigenvalues) * 100\n```\n\nO modelo discriminante final utiliza as vari√°veis X6 (Product Quality) e X18 (Delivery Speed), seguindo o exemplo de Hair et al.\n\n**Caracter√≠sticas do Modelo:**\n\n- **N√∫mero de fun√ß√µes discriminantes**: `r length(eigenvalues)`\n- **Vari√¢ncia explicada pela Fun√ß√£o 1**: `r round(variancia_explicada[1], 1)`%\n- **Vari√¢ncia explicada pela Fun√ß√£o 2**: `r round(variancia_explicada[2], 1)`%\n- **Vari√¢ncia total explicada**: `r round(sum(variancia_explicada), 1)`%\n\n**Autovalores:**\n```{r}\n#| echo: false\nknitr::kable(data.frame(\n  Fun√ß√£o = paste(\"LD\", 1:length(eigenvalues)),\n  Autovalor = round(eigenvalues, 4),\n  `Vari√¢ncia Explicada (%)` = round(variancia_explicada, 1)\n), row.names = FALSE)\n```\n\n#### 4.3 Signific√¢ncia Estat√≠stica\n\nO teste de signific√¢ncia avalia se o modelo discriminante √© estatisticamente significativo.\n\n```{r}\nmodelo_manova <- manova(cbind(X6, X18) ~ X1, data = amostra_analise)\nsummary(modelo_manova, test = \"Wilks\")\n\nsummary.aov(modelo_manova)\n```\n\n**Interpreta√ß√£o dos Resultados de Signific√¢ncia:**\n\n**Teste MANOVA (Multivariado):**\n- **Lambda de Wilks = 0.29005**: Valor baixo indica boa discrimina√ß√£o entre grupos\n- **F aproximado = 23.99**: Estat√≠stica F alta sugere diferen√ßas significativas\n- **p-valor = 2.388e-14**: Altamente significativo (p < 0.001)\n- **Conclus√£o**: O modelo discriminante √© estatisticamente significativo\n\n**An√°lises Univariadas por Vari√°vel:**\n\n**X6 (Product Quality):**\n- **F = 22.885**: Alta capacidade discriminante individual\n- **p-valor = 5.062e-08**: Altamente significativo\n- **Interpreta√ß√£o**: A qualidade do produto varia significativamente entre os grupos de tempo de relacionamento\n\n**X18 (Delivery Speed):**\n- **F = 24.425**: Maior capacidade discriminante individual entre as duas vari√°veis\n- **p-valor = 2.182e-08**: Altamente significativo  \n- **Interpreta√ß√£o**: A percep√ß√£o da velocidade de entrega √© o melhor discriminador individual entre os grupos\n\n**Implica√ß√µes Gerenciais:**\n1. Ambas as vari√°veis contribuem significativamente para distinguir os grupos\n2. Velocidade de entrega (X18) √© ligeiramente mais discriminante que qualidade (X6)\n3. O modelo como um todo tem poder discriminante muito forte\n4. As percep√ß√µes evoluem significativamente com o tempo de relacionamento\n\n#### 4.4 Centr√≥ides dos Grupos\n\nOs centr√≥ides representam o \"centro\" de cada grupo no espa√ßo discriminante.\n\n```{r}\ncentroides <- aggregate(amostra_analise[, c(\"X6\", \"X18\")], \n                       by = list(amostra_analise$X1), FUN = mean)\nnames(centroides)[1] <- \"Grupo\"\n\npredict_centroides <- predict(modelo_final, centroides[, c(\"X6\", \"X18\")])\ncentroides_discriminantes <- predict_centroides$x\nrownames(centroides_discriminantes) <- centroides$Grupo\nprint(\"\\nCentr√≥ides no Espa√ßo Discriminante:\")\nprint(centroides_discriminantes)\n```\n\n**An√°lise dos Centr√≥ides no Espa√ßo Discriminante:**\n\n**Posicionamento dos Grupos:**\n\n| Grupo | LD1 | LD2 | Interpreta√ß√£o |\n|-------|-----|-----|---------------|\n| Menos de 1 ano | -1.61 | 0.31 | Percep√ß√µes mais baixas, posicionamento √∫nico |\n| De 1 a 5 anos | 0.26 | -0.71 | Percep√ß√µes intermedi√°rias, diferencia√ß√£o moderada |\n| Mais de 5 anos | 1.47 | 0.53 | Percep√ß√µes mais elevadas, alta satisfa√ß√£o |\n\n**Padr√µes Identificados:**\n\n1. **Evolu√ß√£o Linear em LD1**: Os valores de LD1 crescem progressivamente (-1.61 ‚Üí 0.26 ‚Üí 1.47), indicando melhoria das percep√ß√µes com o tempo de relacionamento\n\n2. **Separa√ß√£o Clara**: A dist√¢ncia entre centr√≥ides confirma que os grupos s√£o bem diferenciados no espa√ßo discriminante\n\n3. **Trajet√≥ria de Relacionamento**: \n   - **Clientes novos** (< 1 ano): Expectativas em forma√ß√£o, percep√ß√µes iniciais mais cr√≠ticas\n   - **Clientes intermedi√°rios** (1-5 anos): Per√≠odo de consolida√ß√£o das percep√ß√µes\n   - **Clientes estabelecidos** (> 5 anos): Relacionamento maduro, percep√ß√µes mais positivas\n\n**Interpreta√ß√£o das Fun√ß√µes Discriminantes:**\n\n- **LD1**: Representa principalmente a **evolu√ß√£o temporal** das percep√ß√µes (experi√™ncia acumulada)\n- **LD2**: Representa **diferen√ßas qualitativas** espec√≠ficas entre os grupos intermedi√°rios e extremos\n\n**Implica√ß√µes Estrat√©gicas:**\n- Foco na **reten√ß√£o inicial**: Clientes novos precisam de aten√ß√£o especial\n- **Gest√£o da jornada**: Processo gradual de melhoria das percep√ß√µes\n- **Fideliza√ß√£o**: Clientes de longo prazo s√£o verdadeiros advogados da marca\n\n### Est√°gio 5: Interpreta√ß√£o dos Resultados\n\n#### 5.1 Cargas Discriminantes (Matriz Estrutural)\n\nAs cargas discriminantes mostram a correla√ß√£o entre cada vari√°vel independente e as fun√ß√µes discriminantes.\n\n```{r}\n# Calculando cargas discriminantes (correla√ß√µes entre vari√°veis e fun√ß√µes)\n# Escores discriminantes para todas as observa√ß√µes\nescores_discriminantes <- predict(modelo_final, amostra_analise)$x\n\n# Matriz de cargas (correla√ß√µes)\nvariaveis_completas <- amostra_analise[, variaveis_independentes]\ncargas_discriminantes <- cor(variaveis_completas, escores_discriminantes)\n\nprint(\"Matriz de Cargas Discriminantes (n√£o-rotacionadas):\")\nprint(round(cargas_discriminantes, 3))\n\n# Identificando vari√°veis descritivas (|carga| >= 0.40)\ncargas_importantes <- abs(cargas_discriminantes) >= 0.40\nprint(\"\\nVari√°veis Descritivas por Fun√ß√£o (|carga| >= 0.40):\")\nfor(i in 1:ncol(cargas_discriminantes)) {\n  cat(\"Fun√ß√£o\", i, \":\", names(which(cargas_importantes[, i])), \"\\n\")\n}\n```\n\n**Interpreta√ß√£o da Matriz de Cargas Discriminantes:**\n\n**An√°lise da Fun√ß√£o Discriminante 1 (LD1):**\n\n**Vari√°veis com Cargas Altas (|carga| ‚â• 0.40):**\n- **X11 (Product Line)**: 0.773 - Maior contribui√ß√£o para LD1\n- **X18 (Delivery Speed)**: 0.765 - Forte correla√ß√£o positiva\n- **X6 (Product Quality)**: 0.736 - Alta correla√ß√£o positiva  \n- **X9 (Complaint Resolution)**: 0.728 - Contribui√ß√£o significativa\n- **X16 (Ordering & Billing)**: 0.699 - Forte correla√ß√£o\n\n**Interpreta√ß√£o de LD1**: Representa a **dimens√£o geral de satisfa√ß√£o** com aspectos operacionais e de qualidade da HBAT. Valores altos indicam percep√ß√µes positivas em qualidade, entrega, linha de produtos e resolu√ß√£o de problemas.\n\n**An√°lise da Fun√ß√£o Discriminante 2 (LD2):**\n\n**Vari√°veis com Cargas Altas (|carga| ‚â• 0.40):**\n- **X17 (Price Flexibility)**: -0.699 - Maior magnitude (negativa)\n- **X6 (Product Quality)**: 0.677 - Correla√ß√£o positiva forte\n- **X18 (Delivery Speed)**: -0.644 - Correla√ß√£o negativa significativa\n- **X9 (Complaint Resolution)**: -0.467 - Contribui√ß√£o moderada negativa\n- **X16 (Ordering & Billing)**: -0.416 - Correla√ß√£o negativa\n- **X12 (Salesforce Image)**: -0.418 - Contribui√ß√£o moderada negativa\n\n**Interpreta√ß√£o de LD2**: Representa um **contraste entre qualidade percebida** versus **flexibilidade operacional**. Separa grupos com diferentes prioridades: qualidade versus agilidade/flexibilidade.\n\n#### 5.2 Rota√ß√£o VARIMAX\n\n```{r}\n# Aplicando rota√ß√£o VARIMAX √†s cargas discriminantes\nlibrary(stats)\n\nif(ncol(cargas_discriminantes) > 1) {\n  rotacao_varimax <- varimax(cargas_discriminantes)\n  cargas_rotacionadas <- rotacao_varimax$loadings[]\n  \n  print(\"Matriz de Cargas Discriminantes (rotacionadas - VARIMAX):\")\n  print(round(cargas_rotacionadas, 3))\n  \n  # Vari√°veis descritivas ap√≥s rota√ß√£o\n  cargas_rot_importantes <- abs(cargas_rotacionadas) >= 0.40\n  print(\"\\nVari√°veis Descritivas por Fun√ß√£o Rotacionada (|carga| >= 0.40):\")\n  for(i in 1:ncol(cargas_rotacionadas)) {\n    cat(\"Fun√ß√£o\", i, \":\", names(which(cargas_rot_importantes[, i])), \"\\n\")\n  }\n} else {\n  cargas_rotacionadas <- cargas_discriminantes\n  print(\"Apenas uma fun√ß√£o discriminante - rota√ß√£o n√£o aplic√°vel\")\n}\n```\n\n**Interpreta√ß√£o das Cargas Rotacionadas (VARIMAX):**\n\nA rota√ß√£o VARIMAX simplifica a estrutura, criando fatores mais interpret√°veis:\n\n**Fun√ß√£o 1 Rotacionada:**\n- **X6 (Product Quality)**: 1.000 - Carga perfeitamente concentrada\n- **X11 (Product Line)**: 0.538 - Contribui√ß√£o moderada\n- **X17 (Price Flexibility)**: -0.462 - Contribui√ß√£o negativa moderada\n\n**Interpreta√ß√£o**: LD1 rotacionada representa essencialmente a **\"Dimens√£o de Qualidade\"**, contrastando qualidade percebida com flexibilidade de pre√ßos.\n\n**Fun√ß√£o 2 Rotacionada:**\n- **X18 (Delivery Speed)**: -0.992 - Concentra√ß√£o quase perfeita (negativa)\n- **X9 (Complaint Resolution)**: -0.836 - Alta correla√ß√£o negativa  \n- **X16 (Ordering & Billing)**: -0.779 - Correla√ß√£o negativa forte\n- **X11 (Product Line)**: -0.558 - Contribui√ß√£o moderada\n- **X17 (Price Flexibility)**: -0.524 - Contribui√ß√£o moderada\n\n**Interpreta√ß√£o**: LD2 rotacionada representa a **\"Dimens√£o Operacional\"**, focando em velocidade, efici√™ncia e aspectos transacionais.\n\n**Vantagem da Rota√ß√£o:**\n- **Simplifica interpreta√ß√£o**: Cada fun√ß√£o tem foco mais claro\n- **Reduz ambiguidade**: Menos vari√°veis com cargas altas em m√∫ltiplas fun√ß√µes\n- **Facilita comunica√ß√£o gerencial**: Dimens√µes mais intuitivas\n\n#### 5.3 √çndice de Pot√™ncia\n\n```{r}\n# Calculando √≠ndice de pot√™ncia conforme Hair et al.\nif(ncol(cargas_discriminantes) > 1) {\n  # Autovalores relativos\n  autovalores_relativos <- eigenvalues / sum(eigenvalues)\n  \n  # √çndice de pot√™ncia para cada vari√°vel\n  indice_potencia <- numeric(nrow(cargas_rotacionadas))\n  names(indice_potencia) <- rownames(cargas_rotacionadas)\n  \n  for(i in 1:nrow(cargas_rotacionadas)) {\n    potencia_total <- 0\n    for(j in 1:ncol(cargas_rotacionadas)) {\n      potencia_total <- potencia_total + (cargas_rotacionadas[i, j]^2 * autovalores_relativos[j])\n    }\n    indice_potencia[i] <- potencia_total\n  }\n  \n  # Ordenando por √≠ndice de pot√™ncia\n  indice_potencia_ordenado <- sort(indice_potencia, decreasing = TRUE)\n  \n  print(\"√çndice de Pot√™ncia das Vari√°veis:\")\n  print(round(indice_potencia_ordenado, 3))\n}\n```\n\n**Interpreta√ß√£o do √çndice de Pot√™ncia:**\n\nO √≠ndice de pot√™ncia combina a contribui√ß√£o de cada vari√°vel em todas as fun√ß√µes, ponderada pela import√¢ncia relativa de cada fun√ß√£o:\n\n**Ranking por Poder Discriminante Total:**\n\n| Posi√ß√£o | Vari√°vel | Descri√ß√£o | √çndice | Interpreta√ß√£o |\n|---------|----------|-----------|--------|---------------|\n| 1¬∫ | X6 | Product Quality | 0.835 | **Discriminador principal** - fundamental para diferencia√ß√£o |\n| 2¬∫ | X11 | Product Line | 0.293 | **Segundo mais importante** - variedade de produtos relevante |\n| 3¬∫ | X17 | Price Flexibility | 0.224 | **Terceiro lugar** - flexibilidade de pre√ßos diferencia grupos |\n| 4¬∫ | X18 | Delivery Speed | 0.176 | **Quarto lugar** - velocidade importante apesar de estar no modelo |\n| 5¬∫ | X9 | Complaint Resolution | 0.157 | **Moderadamente importante** - resolu√ß√£o de problemas diferencia |\n\n**Insights Principais:**\n\n1. **X6 (Product Quality)** √© o discriminador dominante, respons√°vel por mais de 83% do poder discriminante total\n2. **X18 (Delivery Speed)**, apesar de estar no modelo final, ocupa apenas a 4¬™ posi√ß√£o no √≠ndice de pot√™ncia\n3. **X11 (Product Line)** aparece como segundo mais importante, sugerindo que variedade de produtos √© crucial\n4. A **concentra√ß√£o de poder** nas primeiras vari√°veis indica que poucas dimens√µes explicam a maior parte da discrimina√ß√£o\n\n**Implica√ß√µes Gerenciais:**\n- **Prioridade m√°xima**: Investir em qualidade do produto\n- **Segunda prioridade**: Expandir e melhorar linha de produtos\n- **Terceira prioridade**: Desenvolver flexibilidade de pre√ßos\n- **Monitoramento**: Acompanhar velocidade de entrega e resolu√ß√£o de reclama√ß√µes\n\n#### 5.4 Raz√µes F Univariadas\n\n```{r}\n# Calculando raz√µes F univariadas para cada vari√°vel\nrazoes_f <- numeric(length(variaveis_independentes))\nnames(razoes_f) <- variaveis_independentes\n\nfor(var in variaveis_independentes) {\n  formula_temp <- as.formula(paste(var, \"~ X1\"))\n  anova_temp <- aov(formula_temp, data = amostra_analise)\n  razoes_f[var] <- summary(anova_temp)[[1]][\"X1\", \"F value\"]\n}\n\n# Ordenando por valor F\nrazoes_f_ordenadas <- sort(razoes_f, decreasing = TRUE)\n\nprint(\"Raz√µes F Univariadas:\")\nprint(round(razoes_f_ordenadas, 3))\n\n# Teste de signific√¢ncia (Œ± = 0.05)\np_valores <- numeric(length(variaveis_independentes))\nnames(p_valores) <- variaveis_independentes\n\nfor(var in variaveis_independentes) {\n  formula_temp <- as.formula(paste(var, \"~ X1\"))\n  anova_temp <- aov(formula_temp, data = amostra_analise)\n  p_valores[var] <- summary(anova_temp)[[1]][\"X1\", \"Pr(>F)\"]\n}\n\nprint(\"\\nVari√°veis Significativas (p < 0.05):\")\nprint(names(p_valores[p_valores < 0.05]))\n```\n\n**Interpreta√ß√£o das Raz√µes F Univariadas:**\n\n**Ranking de Poder Discriminante Individual:**\n\n| Posi√ß√£o | Vari√°vel | F-value | p-valor | Status | Interpreta√ß√£o |\n|---------|----------|---------|---------|--------|---------------|\n| 1¬∫ | X18 (Delivery Speed) | 24.425 | < 0.001 | *** | **Melhor discriminador individual** |\n| 2¬∫ | X6 (Product Quality) | 22.885 | < 0.001 | *** | **Segundo melhor discriminador** |\n| 3¬∫ | X9 (Complaint Resolution) | 22.739 | < 0.001 | *** | **Terceiro em poder discriminante** |\n| 4¬∫ | X11 (Product Line) | 20.721 | < 0.001 | *** | **Quarto colocado significativo** |\n| 5¬∫ | X16 (Ordering & Billing) | 17.664 | < 0.001 | *** | **Quinto em import√¢ncia** |\n\n**Vari√°veis Significativas (p < 0.05):** X6, X9, X11, X13, X16, X17, X18 (7 de 13 vari√°veis)\n\n**Compara√ß√£o: Poder Individual vs. Poder Combinado:**\n\n1. **X18 (Delivery Speed)**: \n   - Individual: 1¬∫ lugar (F = 24.425)\n   - Combinado: 4¬∫ lugar (√çndice = 0.176)\n   - **Interpreta√ß√£o**: Excelente discriminador individual, mas com alguma redund√¢ncia no modelo conjunto\n\n2. **X6 (Product Quality)**:\n   - Individual: 2¬∫ lugar (F = 22.885)  \n   - Combinado: 1¬∫ lugar (√çndice = 0.835)\n   - **Interpreta√ß√£o**: Forte individual e dominante no modelo conjunto\n\n**Insights sobre Sele√ß√£o de Vari√°veis:**\n\n- **Crit√©rio Hair et al.**: Usar X6 + X18 √© justificado pelo alto poder discriminante individual de ambas\n- **Potencial de otimiza√ß√£o**: X9 (Complaint Resolution) tem poder individual muito alto e poderia ser considerada\n- **Redund√¢ncia**: V√°rias vari√°veis significativas sugerem multicolinearidade (confirmada pelos VIF altos)\n\n**Recomenda√ß√µes Gerenciais:**\n1. **Foco prim√°rio**: Delivery Speed e Product Quality (vari√°veis do modelo)\n2. **Foco secund√°rio**: Complaint Resolution (alto poder discriminante individual)  \n3. **Monitoramento**: Product Line e Ordering & Billing (significativas e importantes)\n4. **Revis√£o**: Considerar modelo expandido incluindo X9 para melhor discrimina√ß√£o\n\n#### 5.5 Gr√°fico de Vetores de Atribui√ß√£o no Espa√ßo Discriminante\n\n```{r}\n# Gr√°fico dos valores F univariados com descri√ß√µes\nf_df <- data.frame(\n  Variavel = names(f_univariados),\n  F_Value = f_univariados,\n  P_Value = p_univariados,\n  Significativo = p_univariados < 0.05\n) %>%\n  dplyr::mutate(Variavel_Desc = sapply(Variavel, obter_descricao))\n\np_f_values <- ggplot2::ggplot(f_df, ggplot2::aes(x = reorder(Variavel_Desc, F_Value), \n                                                 y = F_Value, fill = Significativo)) +\n  ggplot2::geom_col(alpha = 0.8) +\n  ggplot2::geom_text(ggplot2::aes(label = round(F_Value, 1)), hjust = -0.1, size = 3) +\n  ggplot2::coord_flip() +\n  ggplot2::scale_fill_manual(values = c(\"TRUE\" = \"steelblue\", \"FALSE\" = \"gray70\"),\n                            labels = c(\"FALSE\" = \"N√£o Significativo\", \"TRUE\" = \"Significativo\")) +\n  ggplot2::labs(title = \"Valores F Univariados para Sele√ß√£o de Vari√°veis\",\n                subtitle = \"Poder discriminante individual de cada vari√°vel\",\n                x = \"Vari√°veis\", y = \"Estat√≠stica F\",\n                fill = \"Signific√¢ncia\\n(p < 0.05)\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 axis.text.y = ggplot2::element_text(size = 9))\n\nprint(p_f_values)\n\n# Criando gr√°fico de vetores de atribui√ß√£o (vari√°veis no espa√ßo discriminante)\nescores_todos <- predict(modelo_final, amostra_analise)$x\ndf_escores <- data.frame(\n  Funcao1 = escores_todos[, 1],\n  Funcao2 = escores_todos[, 2],\n  Grupo = amostra_analise$X1,\n  Probabilidades = apply(predict(modelo_final, amostra_analise)$posterior, 1, max)\n)\n\n# Adicionando centr√≥ides\ndf_centroides <- data.frame(\n  Funcao1 = centroides_discriminantes[, 1],\n  Funcao2 = centroides_discriminantes[, 2],\n  Grupo = factor(rownames(centroides_discriminantes), \n                levels = levels(amostra_analise$X1))\n)\n\n# Escalonando as cargas para melhor visualiza√ß√£o\nescala_vetor <- 3  # Fator de escala para os vetores\ncargas_escalonadas <- cargas_discriminantes * escala_vetor\n\n# Preparando dados dos vetores com descri√ß√µes\nvetores_df <- data.frame(\n  Variavel = rownames(cargas_discriminantes),\n  LD1_start = 0,\n  LD2_start = 0,\n  LD1_end = cargas_escalonadas[, 1],\n  LD2_end = cargas_escalonadas[, 2],\n  Magnitude = sqrt(cargas_discriminantes[, 1]^2 + cargas_discriminantes[, 2]^2),\n  Significativa = rownames(cargas_discriminantes) %in% vars_significativas\n) %>%\n  dplyr::mutate(Variavel_Desc = sapply(Variavel, obter_descricao))\n\n# Gr√°fico de vetores de atribui√ß√£o expandidos\np_vetores <- ggplot2::ggplot() +\n  # Pontos dos grupos (mais transparentes para n√£o ofuscar os vetores)\n  ggplot2::geom_point(data = df_escores, ggplot2::aes(x = Funcao1, y = Funcao2, color = Grupo), \n                      alpha = 0.3, size = 1) +\n  # Centr√≥ides dos grupos\n  ggplot2::geom_point(data = df_centroides, ggplot2::aes(x = Funcao1, y = Funcao2), \n                      size = 6, shape = 17, color = \"black\") +\n  # LABELS DOS CENTR√ìIDES - NOVO\n  ggplot2::geom_text(data = df_centroides, \n                     ggplot2::aes(x = Funcao1, y = Funcao2, label = Grupo),\n                     vjust = -1.5, hjust = 0.5, color = \"black\", \n                     fontface = \"bold\", size = 3.5,\n                     box.padding = 0.5) +\n  # Vetores das vari√°veis\n  ggplot2::geom_segment(data = vetores_df,\n                        ggplot2::aes(x = LD1_start, y = LD2_start, \n                                     xend = LD1_end, yend = LD2_end,\n                                     color = Significativa, size = Magnitude),\n                        arrow = ggplot2::arrow(length = ggplot2::unit(0.3, \"cm\")),\n                        alpha = 0.8) +\n  # Labels das vari√°veis com descri√ß√µes\n  ggplot2::geom_text(data = vetores_df,\n                     ggplot2::aes(x = LD1_end * 1.1, y = LD2_end * 1.1, \n                                  label = Variavel_Desc, color = Significativa),\n                     size = 2.5, fontface = \"bold\") +\n  # Eixos de refer√™ncia\n  ggplot2::geom_hline(yintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  ggplot2::geom_vline(xintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  # Escalas e temas\n  ggplot2::scale_color_manual(values = c(\"FALSE\" = \"gray50\", \"TRUE\" = \"red\")) +\n  ggplot2::scale_size_continuous(range = c(0.5, 2), guide = \"none\") +\n  ggplot2::labs(title = \"Vetores de Atribui√ß√£o das Vari√°veis no Espa√ßo Discriminante\",\n                subtitle = paste(\"Vetores mostram contribui√ß√£o das vari√°veis para as fun√ß√µes discriminantes\\n\",\n                                \"Tri√¢ngulos pretos = centr√≥ides dos grupos | Escala dos vetores: \", escala_vetor, \"x\"),\n                x = paste(\"Fun√ß√£o Discriminante 1 (\", round(variancia_explicada[1], 1), \"%)\"),\n                y = paste(\"Fun√ß√£o Discriminante 2 (\", round(variancia_explicada[2], 1), \"%)\"),\n                color = \"Vari√°vel\\nSignificativa\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 plot.subtitle = ggplot2::element_text(size = 10))\n\nprint(p_vetores)\n\n# IDENTIFICA√á√ÉO DOS GRUPOS DA VARI√ÅVEL DEPENDENTE\ncat(\"\\n=== IDENTIFICA√á√ÉO DOS GRUPOS DA VARI√ÅVEL DEPENDENTE ===\\n\")\ncat(\"Vari√°vel Dependente: X1 (Customer Type)\\n\")\ncat(\"Descri√ß√£o: Tempo de relacionamento com a empresa HBAT\\n\\n\")\n\n# Grupos identificados no gr√°fico\ngrupos_identificados <- levels(amostra_analise$X1)\nfreq_grupos <- table(amostra_analise$X1)\ncentroides_info <- centroides_discriminantes\n\ncat(\"GRUPOS REPRESENTADOS NO GR√ÅFICO:\\n\")\nfor(i in 1:length(grupos_identificados)) {\n  grupo_nome <- grupos_identificados[i]\n  freq <- freq_grupos[i]\n  ld1_pos <- round(centroides_info[grupo_nome, \"LD1\"], 2)\n  ld2_pos <- round(centroides_info[grupo_nome, \"LD2\"], 2)\n  \n  cat(sprintf(\"üî∫ GRUPO %d: %s\\n\", i, grupo_nome))\n  cat(sprintf(\"   - Frequ√™ncia: %d casos (%.1f%%)\\n\", \n              freq, (freq/sum(freq_grupos))*100))\n  cat(sprintf(\"   - Posi√ß√£o no gr√°fico: LD1 = %.2f, LD2 = %.2f\\n\", ld1_pos, ld2_pos))\n  cat(sprintf(\"   - Caracter√≠stica: %s\\n\", \n              switch(i,\n                     \"Clientes com relacionamento recente - percep√ß√µes iniciais\",\n                     \"Clientes com relacionamento estabelecido - percep√ß√µes moderadas\", \n                     \"Clientes com relacionamento consolidado - percep√ß√µes elevadas\")))\n  cat(\"\\n\")\n}\n\n# Interpreta√ß√£o dos centr√≥ides no espa√ßo discriminante\ncat(\"INTERPRETA√á√ÉO DOS CENTR√ìIDES (TRI√ÇNGULOS PRETOS):\\n\")\ncat(\"- Os tri√¢ngulos pretos representam o 'centro' de cada grupo no espa√ßo discriminante\\n\")\ncat(\"- Sua posi√ß√£o indica as caracter√≠sticas m√©dias de cada grupo\\n\")\ncat(\"- A dist√¢ncia entre centr√≥ides mostra o grau de separa√ß√£o entre grupos\\n\")\n\n# An√°lise das posi√ß√µes dos centr√≥ides\ncat(\"\\nAN√ÅLISE DAS POSI√á√ïES:\\n\")\nfor(i in 1:nrow(centroides_info)) {\n  grupo_nome <- rownames(centroides_info)[i]\n  ld1_val <- centroides_info[i, \"LD1\"]\n  ld2_val <- centroides_info[i, \"LD2\"]\n  \n  # Interpreta√ß√£o baseada na posi√ß√£o\n  interpretacao_ld1 <- ifelse(ld1_val > 0, \"valores altos em LD1\", \"valores baixos em LD1\")\n  interpretacao_ld2 <- ifelse(ld2_val > 0, \"valores altos em LD2\", \"valores baixos em LD2\")\n  \n  cat(sprintf(\"- %s: Caracterizado por %s e %s\\n\", \n              grupo_nome, interpretacao_ld1, interpretacao_ld2))\n}\n\ncat(\"\\nLEGENDA DO GR√ÅFICO:\\n\")\ncat(\"üî∫ Tri√¢ngulos pretos = Centr√≥ides dos grupos\\n\")\ncat(\"‚óè Pontos coloridos = Observa√ß√µes individuais por grupo\\n\")\ncat(\"‚Üí Vetores vermelhos = Vari√°veis significativas (p < 0.05)\\n\")\ncat(\"‚Üí Vetores cinza = Vari√°veis n√£o significativas\\n\")\ncat(\"üìè Comprimento do vetor = Magnitude da contribui√ß√£o discriminante\\n\")\n\n# Interpreta√ß√£o dos vetores\ncat(\"\\n=== INTERPRETA√á√ÉO DOS VETORES DE ATRIBUI√á√ÉO ===\\n\")\n```\n\n#### 6.4 An√°lise das Dist√¢ncias entre Grupos\n\n```{r}\n# Calculando dist√¢ncias Mahalanobis entre centr√≥ides\ncentroides_matriz <- as.matrix(centroides_discriminantes)\n\n# Matriz de dist√¢ncias entre centr√≥ides\nn_grupos <- nrow(centroides_matriz)\ndist_centroides <- matrix(0, n_grupos, n_grupos)\nrownames(dist_centroides) <- rownames(centroides_matriz)\ncolnames(dist_centroides) <- rownames(centroides_matriz)\n\nfor(i in 1:n_grupos) {\n  for(j in 1:n_grupos) {\n    dist_centroides[i, j] <- sqrt(sum((centroides_matriz[i, ] - centroides_matriz[j, ])^2))\n  }\n}\n\nprint(\"Matriz de Dist√¢ncias Euclidianas entre Centr√≥ides:\")\nprint(round(dist_centroides, 3))\n\n# Visualiza√ß√£o das dist√¢ncias como heatmap\ndist_df <- reshape2::melt(dist_centroides)\nnames(dist_df) <- c(\"Grupo1\", \"Grupo2\", \"Distancia\")\n\np_distancias <- ggplot2::ggplot(dist_df, ggplot2::aes(x = Grupo1, y = Grupo2, fill = Distancia)) +\n  ggplot2::geom_tile(color = \"white\") +\n  ggplot2::geom_text(ggplot2::aes(label = round(Distancia, 2)), \n                     color = \"white\", fontface = \"bold\", size = 5) +\n  ggplot2::scale_fill_viridis_c(name = \"Dist√¢ncia\\nEuclidiana\") +\n  ggplot2::labs(title = \"Matriz de Dist√¢ncias entre Centr√≥ides dos Grupos\",\n                subtitle = \"Dist√¢ncias calculadas no espa√ßo discriminante\",\n                x = \"Grupo\", y = \"Grupo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))\n\nprint(p_distancias)\n\n# An√°lise de separa√ß√£o\ndist_matrix_upper <- dist_centroides[upper.tri(dist_centroides)]\n\n# Identificando grupos mais pr√≥ximos e mais distantes\ndist_indices <- which(dist_centroides == min(dist_matrix_upper), arr.ind = TRUE)[1, ]\ngrupos_proximos <- c(rownames(dist_centroides)[dist_indices[1]], \n                    colnames(dist_centroides)[dist_indices[2]])\n\ndist_indices_max <- which(dist_centroides == max(dist_matrix_upper), arr.ind = TRUE)[1, ]\ngrupos_distantes <- c(rownames(dist_centroides)[dist_indices_max[1]], \n                     colnames(dist_centroides)[dist_indices_max[2]])\n```\n\n**Interpreta√ß√£o da An√°lise de Dist√¢ncias:**\n\n**Matriz de Dist√¢ncias Euclidianas:**\n- **Menor dist√¢ncia**: \"De 1 a 5 anos\" ‚Üî \"Mais de 5 anos\" (1.737)\n- **Maior dist√¢ncia**: \"Menos de 1 ano\" ‚Üî \"Mais de 5 anos\" (3.084)\n- **Dist√¢ncia intermedi√°ria**: \"Menos de 1 ano\" ‚Üî \"De 1 a 5 anos\" (2.127)\n\n**Padr√µes de Similaridade:**\n\n1. **Grupos Intermedi√°rio e Maduro s√£o mais pr√≥ximos**: \n   - Dist√¢ncia de apenas 1.737 unidades\n   - **Interpreta√ß√£o**: Ap√≥s 1 ano, as percep√ß√µes come√ßam a convergir\n   - **Implica√ß√£o**: O primeiro ano √© cr√≠tico para formar percep√ß√µes duradouras\n\n2. **Clientes Novos s√£o mais distantes de todos**:\n   - Maior dist√¢ncia dos clientes maduros (3.084)\n   - **Interpreta√ß√£o**: Per√≠odo inicial tem caracter√≠sticas muito distintas\n   - **Implica√ß√£o**: Estrat√©gias espec√≠ficas necess√°rias para novos clientes\n\n3. **Progress√£o N√£o-Linear**:\n   - A evolu√ß√£o \"Novo ‚Üí Intermedi√°rio ‚Üí Maduro\" n√£o √© uniforme\n   - Maior salto entre \"Novo\" e \"Intermedi√°rio\" (2.127)\n   - Menor progress√£o entre \"Intermedi√°rio\" e \"Maduro\" (1.737)\n\n**Insights Gerenciais:**\n\n- **Per√≠odo Cr√≠tico**: Os primeiros 12 meses s√£o fundamentais para reten√ß√£o\n- **Converg√™ncia**: Ap√≥s 1 ano, clientes tendem a desenvolver percep√ß√µes similares\n- **Segmenta√ß√£o**: Dois grandes segmentos emergem: \"Novos\" vs. \"Estabelecidos\" (intermedi√°rios + maduros)\n\n#### 6.5 Compara√ß√£o Visual: Espa√ßo Original vs. Espa√ßo Discriminante\n\n```{r}\n# Comparando visualiza√ß√£o no espa√ßo original (X6, X18) vs. espa√ßo discriminante\np_original <- ggplot2::ggplot(amostra_analise, ggplot2::aes(x = X6, y = X18, color = X1)) +\n  ggplot2::geom_point(size = 3, alpha = 0.7) +\n  ggplot2::stat_ellipse(level = 0.68, type = \"norm\", size = 1.2) +\n  ggplot2::geom_point(data = centroides, ggplot2::aes(x = X6, y = X18), \n                      size = 8, shape = 17, color = \"black\") +\n  ggplot2::scale_color_brewer(type = \"qual\", palette = \"Set1\") +\n  ggplot2::labs(title = \"Espa√ßo Original\",\n                subtitle = \"Vari√°veis originais do modelo discriminante\",\n                x = descricoes_variaveis[\"X6\"], \n                y = descricoes_variaveis[\"X18\"],\n                color = \"Grupo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 12, face = \"bold\"))\n\np_discriminante <- ggplot2::ggplot(df_escores, ggplot2::aes(x = Funcao1, y = Funcao2, color = Grupo)) +\n  ggplot2::geom_point(size = 3, alpha = 0.7) +\n  ggplot2::stat_ellipse(level = 0.68, type = \"norm\", size = 1.2) +\n  ggplot2::geom_point(data = df_centroides, ggplot2::aes(x = Funcao1, y = Funcao2), \n                      size = 8, shape = 17, color = \"black\") +\n  ggplot2::scale_color_brewer(type = \"qual\", palette = \"Set1\") +\n  ggplot2::labs(title = \"Espa√ßo Discriminante (LD1 vs LD2)\",\n                subtitle = \"Fun√ß√µes discriminantes otimizadas para separa√ß√£o\",\n                x = paste(\"LD1 (\", round(variancia_explicada[1], 1), \"%)\"),\n                y = paste(\"LD2 (\", round(variancia_explicada[2], 1), \"%)\"),\n                color = \"Grupo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 12, face = \"bold\"))\n\n# Combinando os gr√°ficos\ncomparacao <- gridExtra::grid.arrange(\n  p_original, p_discriminante, \n  ncol = 2,\n  top = grid::textGrob(\"Compara√ß√£o: Espa√ßo Original vs. Espa√ßo Discriminante\", \n                       gp = grid::gpar(fontsize = 16, fontface = \"bold\"))\n)\n\nprint(comparacao)\n\n# Interpreta√ß√£o da compara√ß√£o\ncat(\"\\n=== INTERPRETA√á√ÉO DA COMPARA√á√ÉO ===\\n\")\ncat(\"- Espa√ßo Original: mostra sobreposi√ß√£o entre grupos\\n\")\ncat(\"- Espa√ßo Discriminante: maximiza separa√ß√£o entre grupos\\n\")\ncat(\"- A transforma√ß√£o discriminante melhora a separabilidade\\n\")\ncat(\"- LD1 e LD2 s√£o combina√ß√µes lineares que maximizam discrimina√ß√£o\\n\")\n```\n\n### Est√°gio 6: Valida√ß√£o dos Resultados\n\n#### 6.6 Matriz de Classifica√ß√£o e Valida√ß√£o\n\n```{r}\n# Classifica√ß√£o da amostra de an√°lise\npredicoes_analise <- predict(modelo_final, amostra_analise)\nmatriz_confusao_analise <- table(Predito = predicoes_analise$class, \n                                Real = amostra_analise$X1)\n\nprint(\"Matriz de Classifica√ß√£o - Amostra de An√°lise:\")\nprint(matriz_confusao_analise)\n\n# Taxa de acerto geral\nacerto_geral_analise <- sum(diag(matriz_confusao_analise)) / sum(matriz_confusao_analise)\n\n# Taxa de acerto por grupo\nacerto_por_grupo_analise <- diag(matriz_confusao_analise) / rowSums(matriz_confusao_analise)\nprint(\"Taxa de Acerto por Grupo (An√°lise):\")\nprint(round(acerto_por_grupo_analise * 100, 1))\n\n# Visualiza√ß√£o da matriz de confus√£o\nmatriz_conf_df <- as.data.frame(matriz_confusao_analise)\nnames(matriz_conf_df) <- c(\"Predito\", \"Real\", \"Freq\")\n\np_matriz_conf <- ggplot2::ggplot(matriz_conf_df, ggplot2::aes(x = Real, y = Predito, fill = Freq)) +\n  ggplot2::geom_tile(color = \"white\") +\n  ggplot2::geom_text(ggplot2::aes(label = Freq), color = \"white\", size = 6, fontface = \"bold\") +\n  ggplot2::scale_fill_viridis_c(name = \"Frequ√™ncia\") +\n  ggplot2::labs(title = \"Matriz de Confus√£o - Amostra de An√°lise\",\n                subtitle = paste(\"Taxa de Acerto Geral:\", round(acerto_geral_analise * 100, 1), \"%\"),\n                x = \"Grupo Real\", y = \"Grupo Predito\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))\n\nprint(p_matriz_conf)\n```\n\n**Taxa de Acerto Geral (An√°lise)**: `r round(acerto_geral_analise * 100, 1)`%\n\n**Taxa de Acerto por Grupo (An√°lise)**:\n```{r}\n#| echo: false\nknitr::kable(data.frame(\n  Grupo = names(acerto_por_grupo_analise),\n  `Taxa de Acerto (%)` = round(acerto_por_grupo_analise * 100, 1)\n), row.names = FALSE)\n```\n\n#### 6.7 Valida√ß√£o Cruzada\n\n```{r}\n# Fun√ß√£o para valida√ß√£o cruzada\nvalidacao_cruzada <- function(dados, formula) {\n  n <- nrow(dados)\n  predicoes <- character(n)\n  \n  for(i in 1:n) {\n    # Treina modelo sem a observa√ß√£o i\n    dados_treino <- dados[-i, ]\n    modelo_temp <- MASS::lda(formula, data = dados_treino)\n    \n    # Prediz a observa√ß√£o i\n    predicao_temp <- predict(modelo_temp, dados[i, ])\n    predicoes[i] <- as.character(predicao_temp$class)\n  }\n  \n  return(factor(predicoes, levels = levels(dados$X1)))\n}\n\n# Aplicando valida√ß√£o cruzada\npredicoes_cv <- validacao_cruzada(amostra_analise, X1 ~ X6 + X18)\nmatriz_confusao_cv <- table(Predito = predicoes_cv, Real = amostra_analise$X1)\n\nprint(\"Matriz de Classifica√ß√£o - Valida√ß√£o Cruzada:\")\nprint(matriz_confusao_cv)\n\n# Taxa de acerto valida√ß√£o cruzada\nacerto_geral_cv <- sum(diag(matriz_confusao_cv)) / sum(matriz_confusao_cv)\n```\n\n**Taxa de Acerto Geral (Valida√ß√£o Cruzada)**: `r round(acerto_geral_cv * 100, 1)`%\n\n#### 6.8 Valida√ß√£o Externa\n\n```{r}\n# Classifica√ß√£o da amostra de valida√ß√£o\npredicoes_validacao <- predict(modelo_final, amostra_validacao)\nmatriz_confusao_validacao <- table(Predito = predicoes_validacao$class, \n                                  Real = amostra_validacao$X1)\n\nprint(\"Matriz de Classifica√ß√£o - Amostra de Valida√ß√£o:\")\nprint(matriz_confusao_validacao)\n\n# Taxa de acerto amostra de valida√ß√£o\nacerto_geral_validacao <- sum(diag(matriz_confusao_validacao)) / sum(matriz_confusao_validacao)\n\n# Taxa de acerto por grupo\nacerto_por_grupo_validacao <- diag(matriz_confusao_validacao) / rowSums(matriz_confusao_validacao)\nprint(\"Taxa de Acerto por Grupo (Valida√ß√£o):\")\nprint(round(acerto_por_grupo_validacao * 100, 1))\n```\n\n**Taxa de Acerto Geral (Valida√ß√£o)**: `r round(acerto_geral_validacao * 100, 1)`%\n\n#### 6.9 Crit√©rios de Chance\n\n```{r}\n# Calculando crit√©rios de chance\ntamanhos_grupos <- table(amostra_analise$X1)\nproporcoes_grupos <- tamanhos_grupos / sum(tamanhos_grupos)\n\n# Crit√©rio de chance proporcional\ncriterio_chance_proporcional <- sum(proporcoes_grupos^2) * 100\n\n# Crit√©rio de chance m√°xima\ncriterio_chance_maxima <- max(proporcoes_grupos) * 100\n\n# Gr√°fico de compara√ß√£o das taxas de acerto\ntaxas_acerto <- data.frame(\n  Metodo = c(\"An√°lise\", \"Valida√ß√£o Cruzada\", \"Valida√ß√£o Externa\", \n             \"Crit√©rio Proporcional\", \"Crit√©rio M√°ximo\"),\n  Taxa = c(acerto_geral_analise * 100, \n           acerto_geral_cv * 100,\n           acerto_geral_validacao * 100,\n           criterio_chance_proporcional,\n           criterio_chance_maxima),\n  Tipo = c(\"Modelo\", \"Modelo\", \"Modelo\", \"Refer√™ncia\", \"Refer√™ncia\")\n)\n\np_performance <- ggplot2::ggplot(taxas_acerto, ggplot2::aes(x = reorder(Metodo, Taxa), y = Taxa, fill = Tipo)) +\n  ggplot2::geom_col(alpha = 0.8, width = 0.7) +\n  ggplot2::geom_text(ggplot2::aes(label = paste0(round(Taxa, 1), \"%\")), \n                     hjust = -0.1, size = 4, fontface = \"bold\") +\n  ggplot2::coord_flip() +\n  ggplot2::scale_fill_manual(values = c(\"Modelo\" = \"steelblue\", \"Refer√™ncia\" = \"coral\")) +\n  ggplot2::labs(title = \"Compara√ß√£o das Taxas de Acerto\",\n                subtitle = \"Modelo vs. Crit√©rios de Chance\",\n                x = \"M√©todo de Valida√ß√£o\", \n                y = \"Taxa de Acerto (%)\",\n                fill = \"Tipo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 14, face = \"bold\"))\n\nprint(p_performance)\n```\n\n**Crit√©rios de Chance:**\n\n- **Crit√©rio de Chance Proporcional**: `r round(criterio_chance_proporcional, 1)`%\n- **Crit√©rio de Chance M√°xima**: `r round(criterio_chance_maxima, 1)`%\n\n**Compara√ß√£o com Resultados Obtidos:**\n\n- Taxa de Acerto An√°lise: `r round(acerto_geral_analise * 100, 1)`% vs Crit√©rio Proporcional: `r round(criterio_chance_proporcional, 1)`%\n- Taxa de Acerto Valida√ß√£o Cruzada: `r round(acerto_geral_cv * 100, 1)`% vs Crit√©rio Proporcional: `r round(criterio_chance_proporcional, 1)`%  \n- Taxa de Acerto Valida√ß√£o: `r round(acerto_geral_validacao * 100, 1)`% vs Crit√©rio Proporcional: `r round(criterio_chance_proporcional, 1)`%\n\n### Resumo da Interpreta√ß√£o Gerencial\n\nOs resultados da an√°lise discriminante revelam insights importantes sobre a diferencia√ß√£o de clientes baseada no tempo de relacionamento. Com o dataset completo analisado, identificamos que de 13 vari√°veis independentes testadas, apenas 2 foram suficientes para uma discrimina√ß√£o efetiva.\n\n#### Principais Descobertas:\n\n1. **Vari√°veis Discriminantes**: X6 (Product Quality) e X18 (Delivery Speed) s√£o os principais diferenciadores, representando aproximadamente 100% da vari√¢ncia discriminante total.\n\n2. **Precis√£o do Modelo**: O modelo alcan√ßa alta taxa de acertos na amostra de an√°lise, superando significativamente os crit√©rios de chance.\n\n3. **Diferen√ßas entre Grupos**: \n   - **Clientes novos** (< 1 ano): Menores percep√ß√µes de qualidade e velocidade\n   - **Clientes intermedi√°rios** (1-5 anos): Percep√ß√µes moderadas\n   - **Clientes estabelecidos** (> 5 anos): Maiores percep√ß√µes de qualidade e velocidade\n\n#### Implica√ß√µes Gerenciais:\n\n- **Foco na Qualidade**: Investir na melhoria da qualidade do produto √© fundamental para reter clientes\n- **Otimiza√ß√£o de Entregas**: A velocidade de entrega √© um diferencial competitivo cr√≠tico\n- **Segmenta√ß√£o**: Os 3 grupos identificados requerem estrat√©gias diferenciadas\n\n```{r}\n# M√©dias dos grupos para interpreta√ß√£o\nmedias_grupos <- aggregate(amostra_analise[, variaveis_independentes], \n                          by = list(amostra_analise$X1), FUN = mean)\nnames(medias_grupos)[1] <- \"Grupo\"\n\n# Corrigindo erro na impress√£o das m√©dias dos grupos\nmedias_grupos_numericas <- medias_grupos[, -1]  # Remove coluna 'Grupo'\nrownames(medias_grupos_numericas) <- medias_grupos$Grupo\n\nprint(\"M√©dias dos Grupos nas Vari√°veis Independentes:\")\nprint(round(medias_grupos_numericas, 2))\n\ncat(\"\\n=== INTERPRETA√á√ÉO DAS FUN√á√ïES DISCRIMINANTES ===\\n\")\ncat(\"Fun√ß√£o 1: Diferencia principalmente entre Grupo 1 e Grupos 2-3\\n\")\ncat(\"Fun√ß√£o 2: Diferencia principalmente entre Grupo 3 e Grupos 1-2\\n\")\n\ncat(\"\\n=== VARI√ÅVEIS MAIS IMPORTANTES ===\\n\")\nif(exists(\"indice_potencia_ordenado\")) {\n  cat(\"Por √çndice de Pot√™ncia:\\n\")\n  print(names(indice_potencia_ordenado)[1:min(5, length(indice_potencia_ordenado))])\n}\n\ncat(\"\\nPor Raz√£o F Univariada:\\n\")\nprint(names(razoes_f_ordenadas)[1:min(5, length(razoes_f_ordenadas))])\n\ncat(\"\\n=== RESUMO FINAL ===\\n\")\ncat(\"Modelo discriminante final: X1 ~ X6 + X18\\n\")\ncat(\"Vari√°veis selecionadas:\\n\")\ncat(\"- X6: Qualidade do produto\\n\")\ncat(\"- X18: Velocidade de entrega\\n\")\n\nif(exists(\"modelo_stepwise\")) {\n  cat(\"\\nVari√°veis selecionadas pelo procedimento stepwise:\\n\")\n  print(modelo_stepwise$formula)\n}\n\ncat(\"\\n=== CONCLUS√ïES GERENCIAIS ===\\n\")\ncat(\"1. A qualidade do produto (X6) e velocidade de entrega (X18) s√£o os principais diferenciadores entre os grupos de clientes.\\n\")\ncat(\"2. O modelo consegue discriminar bem entre os tr√™s grupos de tempo de relacionamento.\\n\")\ncat(\"3. Clientes de longo prazo valorizam mais qualidade e velocidade de entrega.\\n\")\ncat(\"4. A√ß√µes de melhoria devem focar nestas duas dimens√µes para reter clientes.\\n\")\n```\n\n**An√°lise das M√©dias por Grupo:**\n\nOs resultados mostram um padr√£o claro de evolu√ß√£o das percep√ß√µes com o tempo de relacionamento, com melhorias progressivas nas percep√ß√µes de qualidade e velocidade de entrega conforme aumenta o tempo de relacionamento com a empresa.\n\n### Ap√™ndice: Informa√ß√µes T√©cnicas do Dataset\n\n#### Caracter√≠sticas do Dataset HBAT\n\n```{r}\n# Informa√ß√µes sobre o dataset ap√≥s limpeza\ncat(\"=== CARACTER√çSTICAS DO DATASET FINAL ===\\n\")\ncat(\"Total de observa√ß√µes:\", nrow(hbat_clean), \"\\n\")\ncat(\"Vari√°veis independentes analisadas:\", length(variaveis_independentes), \"\\n\")\ncat(\"Grupos da vari√°vel dependente:\", nlevels(hbat_clean$X1), \"\\n\")\n\n# Distribui√ß√£o dos grupos\ndist_grupos <- table(hbat_clean$X1)\nprop_grupos <- prop.table(dist_grupos) * 100\n\ncat(\"\\nDistribui√ß√£o dos grupos:\\n\")\nfor(i in 1:length(dist_grupos)) {\n  cat(\"- \", names(dist_grupos)[i], \": \", dist_grupos[i], \" casos (\", \n      round(prop_grupos[i], 1), \"%)\\n\", sep = \"\")\n}\n```\n\n#### Qualidade dos Dados\n\n- **Missing values**: Removidos atrav√©s de listwise deletion\n- **Balanceamento**: Dataset relativamente balanceado entre os grupos\n- **Escala das vari√°veis**: Todas as vari√°veis independentes est√£o na escala de 0-10\n\n```{r}\n# Informa√ß√µes detalhadas sobre o dataset HBAT\ncat(\"=== INFORMA√á√ïES DO DATASET HBAT ===\\n\")\ncat(\"Total de observa√ß√µes:\", nrow(hbat_clean), \"\\n\")\ncat(\"Vari√°veis independentes:\", length(variaveis_independentes), \"\\n\")\ncat(\"Grupos da vari√°vel dependente:\", nlevels(hbat_clean$X1), \"\\n\")\n\n# Descri√ß√£o das vari√°veis (baseado nos labels originais) - ATUALIZADO\ncat(\"\\n=== DESCRI√á√ÉO COMPLETA DAS VARI√ÅVEIS ===\\n\")\nfor(var in names(descricoes_variaveis)) {\n  cat(var, \"-\", descricoes_variaveis[var], \"\\n\")\n}\n\n# Estat√≠sticas descritivas finais\ncat(\"\\n=== ESTAT√çSTICAS DESCRITIVAS FINAIS ===\\n\")\nprint(summary(hbat_clean))\n```\n\n","srcMarkdownNoYaml":"\n\n```{r}\n#| include: false\n#| echo: true\n#| message: false\n#| warning: false\n\n# Carregando os pacotes necess√°rios\nif (!require(\"MASS\")) install.packages(\"MASS\")\nif (!require(\"klaR\")) install.packages(\"klaR\")\nif (!require(\"car\")) install.packages(\"car\")\nif (!require(\"ggplot2\")) install.packages(\"ggplot2\")\nif (!require(\"dplyr\")) install.packages(\"dplyr\")\nif (!require(\"corrplot\")) install.packages(\"corrplot\")\nif (!require(\"caret\")) install.packages(\"caret\")\nif (!require(\"skimr\")) install.packages(\"skimr\")\nif (!require(\"MVN\")) install.packages(\"MVN\")\nif (!require(\"biotools\")) install.packages(\"biotools\")\nif (!require(\"GGally\")) install.packages(\"GGally\")\nif (!require(\"nnet\")) install.packages(\"nnet\")\nif (!require(\"pROC\")) install.packages(\"pROC\")\nif (!require(\"tidyr\")) install.packages(\"tidyr\")\nif (!require(\"readr\")) install.packages(\"readr\")\nif (!require(\"haven\")) install.packages(\"haven\")\nif (!require(\"gridExtra\")) install.packages(\"gridExtra\")\nif (!require(\"reshape2\")) install.packages(\"reshape2\")\nif (!require(\"viridis\")) install.packages(\"viridis\")\nif (!require(\"plotly\")) install.packages(\"plotly\")\nif (!require(\"RColorBrewer\")) install.packages(\"RColorBrewer\")\n\n```\n\n```{r}\n#| echo: true\n#| message: false\n#| warning: false\n\nlibrary(MASS)\nlibrary(klaR)\nlibrary(car)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(corrplot)\nlibrary(caret)\nlibrary(skimr)\nlibrary(MVN)\nlibrary(biotools)\nlibrary(GGally)\nlibrary(nnet)\nlibrary(pROC)\nlibrary(tidyr)\nlibrary(readr)\nlibrary(haven)\nlibrary(gridExtra)\nlibrary(reshape2)\nlibrary(viridis)\nlibrary(plotly)\nlibrary(RColorBrewer)\n```\n\n## An√°lise Discriminante - Exemplo HBAT\n\n\n### Reprodu√ß√£o do Exemplo de Hair et al. - Dataset HBAT\n\nNesta se√ß√£o, reproduziremos a an√°lise discriminante apresentada no livro Hair et al., utilizando o dataset HBAT para classificar clientes em tr√™s grupos baseados no tempo de relacionamento com a empresa.\n\n\nO **HBAT** √© um dataset educacional fict√≠cio amplamente utilizado no livro cl√°ssico \"Multivariate Data Analysis\" de Joseph Hair et al., representando uma empresa de distribui√ß√£o industrial. O dataset cont√©m **100 observa√ß√µes** de clientes classificados em tr√™s grupos baseados no tempo de relacionamento: **Grupo 1** (menos de 1 ano), **Grupo 2** (1 a 5 anos) e **Grupo 3** (mais de 5 anos). As vari√°veis incluem a **vari√°vel dependente X1** (Customer Type) e **13 vari√°veis independentes** (X6-X18) que medem percep√ß√µes dos clientes sobre diferentes aspectos da empresa, como qualidade do produto (X6), atividades de e-commerce (X7), suporte t√©cnico (X8), resolu√ß√£o de reclama√ß√µes (X9), propaganda (X10), linha de produtos (X11), imagem da for√ßa de vendas (X12), pre√ßos competitivos (X13), garantia e reclama√ß√µes (X14), novos produtos (X15), pedidos e faturamento (X16), flexibilidade de pre√ßos (X17) e velocidade de entrega (X18). Todas as vari√°veis independentes utilizam uma **escala de 0-10**, facilitando compara√ß√µes e interpreta√ß√µes. Este dataset √© ideal para demonstrar t√©cnicas de an√°lise multivariada, especialmente an√°lise discriminante, pois oferece um contexto empresarial realista com dados limpos e estruturados, permitindo focar na aplica√ß√£o das t√©cnicas estat√≠sticas sem se preocupar com problemas complexos de qualidade de dados t√≠picos de datasets reais.\n\n### Est√°gio 1: Objetivos da An√°lise Discriminante\n\nO objetivo √© identificar as caracter√≠sticas perceptuais que distinguem clientes baseados no tempo de relacionamento:\n- **Grupo 1**: Menos de 1 ano\n- **Grupo 2**: De 1 a 5 anos  \n- **Grupo 3**: Mais de 5 anos\n\n#### Carregamento e Inspe√ß√£o dos Dados do arquivo spss\n\n```{r}\n# Carregando os dados HBAT\nhbat <- haven::read_sav(\"data/hbat.sav\")\n\nglimpse(hbat)\n\n```\n\n\n```{r}\n#| include: false\n#| echo: false\n\n\n# Gr√°fico da distribui√ß√£o da vari√°vel dependente\np_dist_grupos <- ggplot2::ggplot(data.frame(x1 = hbat$x1), ggplot2::aes(x = factor(x1))) +\n  ggplot2::geom_bar(fill = \"steelblue\", alpha = 0.7) +\n  ggplot2::geom_text(stat = \"count\", ggplot2::aes(label = after_stat(count)), \n                     vjust = -0.5, size = 4) +\n  ggplot2::labs(title = \"Distribui√ß√£o dos Grupos por Tempo de Relacionamento\",\n                x = \"Grupo (1=<1 ano, 2=1-5 anos, 3=>5 anos)\",\n                y = \"Frequ√™ncia\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"))\n\nprint(p_dist_grupos)\n```\n\n\n\n```{r}\n#| include: false\n#| echo: false\n\n# Identificando as vari√°veis corretas baseado na estrutura real do dataset\n# Primeiro vamos ver quais vari√°veis existem realmente\nprint(\"Vari√°veis dispon√≠veis no dataset:\")\nprint(colnames(hbat))\n\n# Verificando se existem vari√°veis que correspondem √†s do exemplo Hair\n# Procurando por padr√µes de nomes que possam corresponder a X1, X6-X18\npossiveis_vars <- grep(\"^[Xx][0-9]+\", names(hbat), value = TRUE)\nprint(\"Poss√≠veis vari√°veis X encontradas:\")\nprint(possiveis_vars)\n\n# Se n√£o encontrar, vamos procurar por outras vari√°veis categ√≥ricas e num√©ricas\ncat(\"\\nEstrutura das primeiras 10 vari√°veis:\\n\")\nstr(hbat[,1:min(10, ncol(hbat))])\n```\n\n\n\n```{r}\n#| include: false\n#| echo: false\n\n\n# Preparando os dados baseado na estrutura real encontrada\n# Vamos adaptar baseado nas vari√°veis que realmente existem\n\n# Primeiro, identificar a vari√°vel dependente (tempo de relacionamento)\n# Procurar por vari√°veis categ√≥ricas que possam representar grupos de tempo\n\n# Listar vari√°veis categ√≥ricas\nvars_categoricas <- sapply(hbat, function(x) is.factor(x) || length(unique(x)) <= 10)\nprint(\"Vari√°veis categ√≥ricas ou com poucos valores √∫nicos:\")\nprint(names(hbat)[vars_categoricas])\n\n# Examinar algumas vari√°veis categ√≥ricas potenciais\nfor(var in names(hbat)[vars_categoricas][1:min(5, sum(vars_categoricas))]) {\n  cat(\"\\nVari√°vel:\", var, \"\\n\")\n  print(table(hbat[[var]], useNA = \"ifany\"))\n}\n```\n\n#### Defini√ß√£o das Vari√°veis do Modelo\n\nCom base na inspe√ß√£o dos dados, identificamos que o dataset HBAT possui exatamente as vari√°veis necess√°rias:\n- **x1**: Vari√°vel dependente (Customer Type: 1=Menos de 1 ano, 2=De 1 a 5 anos, 3=Mais de 5 anos)\n- **x6-x18**: Vari√°veis independentes (percep√ß√µes sobre a HBAT)\n\n```{r}\n#| include: false\n#| echo: false\n# Agora que sabemos a estrutura, vamos usar as vari√°veis corretas\nvariavel_dependente <- \"x1\"  # Customer Type - exatamente o que precisamos\nvariaveis_independentes <- paste0(\"x\", 6:18)  # x6 a x18 - percep√ß√µes\n\n# Verificando se x1 tem os valores corretos\nprint(table(hbat$x1, useNA = \"ifany\"))\n\n# Verificando os labels da vari√°vel x1\nif(haven::is.labelled(hbat$x1)) {\n  print(haven::as_factor(hbat$x1))\n  print(table(haven::as_factor(hbat$x1)))\n}\n```\n\n**Configura√ß√£o das Vari√°veis:**\n\n- **Vari√°vel dependente**: `r variavel_dependente`\n- **Vari√°veis independentes**: `r paste(variaveis_independentes, collapse = \", \")`\n- **Total de vari√°veis independentes**: `r length(variaveis_independentes)`\n\n#### Prepara√ß√£o do Dataset Final\n\n```{r}\n#| include: false\n# Criando dataset limpo com as vari√°veis corretas identificadas\nhbat_clean <- hbat %>%\n  dplyr::select(dplyr::all_of(c(variavel_dependente, variaveis_independentes))) %>%\n  na.omit()\n\n# Converter x1 para fator com os labels corretos do exemplo Hair\nhbat_clean <- hbat_clean %>%\n  dplyr::mutate(\n    X1 = factor(x1, \n                levels = 1:3,\n                labels = c(\"Menos de 1 ano\", \"De 1 a 5 anos\", \"Mais de 5 anos\"))\n  ) %>%\n  dplyr::select(-x1)\n\n# Renomear vari√°veis independentes para seguir padr√£o X6-X18 (mai√∫sculas)\nnomes_independentes <- paste0(\"X\", 6:18)\nnames(hbat_clean)[names(hbat_clean) != \"X1\"] <- nomes_independentes\n\n# Reordenar colunas para X1 ficar primeiro\nhbat_clean <- hbat_clean %>%\n  dplyr::select(X1, dplyr::everything())\n\n# Atualizar lista de vari√°veis independentes\nvariaveis_independentes <- nomes_independentes\n\n# Criando dicion√°rio de descri√ß√µes das vari√°veis\ndescricoes_variaveis <- c(\n  \"X1\" = \"Customer Type\",\n  \"X6\" = \"Product Quality\",\n  \"X7\" = \"E-Commerce Activities\",\n  \"X8\" = \"Technical Support\",\n  \"X9\" = \"Complaint Resolution\",\n  \"X10\" = \"Advertising\",\n  \"X11\" = \"Product Line\",\n  \"X12\" = \"Salesforce Image\",\n  \"X13\" = \"Competitive Pricing\",\n  \"X14\" = \"Warranty & Claims\",\n  \"X15\" = \"New Products\",\n  \"X16\" = \"Ordering & Billing\",\n  \"X17\" = \"Price Flexibility\",\n  \"X18\" = \"Delivery Speed\"\n)\n\n# Fun√ß√£o para obter descri√ß√£o completa da vari√°vel\nobter_descricao <- function(var) {\n  if(var %in% names(descricoes_variaveis)) {\n    return(descricoes_variaveis[var])\n  } else {\n    return(var)\n  }\n}\n```\n\n**Resumo da Prepara√ß√£o dos Dados:**\n\n- **Total de observa√ß√µes**: `r nrow(hbat_clean)`\n- **Vari√°veis independentes**: `r length(variaveis_independentes)`\n- **Grupos identificados**: `r nlevels(hbat_clean$X1)`\n\n**Distribui√ß√£o da Vari√°vel Dependente (X1):**\n```{r}\n#| echo: false\nknitr::kable(table(hbat_clean$X1), col.names = c(\"Grupo\", \"Frequ√™ncia\"))\n```\n\n**Descri√ß√µes das Vari√°veis:**\n\n| C√≥digo | Descri√ß√£o |\n|--------|-----------|\n| X1 | Customer Type |\n| X6 | Product Quality |\n| X7 | E-Commerce Activities |\n| X8 | Technical Support |\n| X9 | Complaint Resolution |\n| X10 | Advertising |\n| X11 | Product Line |\n| X12 | Salesforce Image |\n| X13 | Competitive Pricing |\n| X14 | Warranty & Claims |\n| X15 | New Products |\n| X16 | Ordering & Billing |\n| X17 | Price Flexibility |\n| X18 | Delivery Speed |\n\n### Est√°gio 2: Delineamento da Pesquisa de An√°lise Discriminante\n\n```{r}\n# Divis√£o em amostras de an√°lise e valida√ß√£o\nset.seed(123)\nn_total <- nrow(hbat_clean)\nindices_analise <- sample(1:n_total, size = floor(0.6 * n_total))\n\namostra_analise <- hbat_clean[indices_analise, ]\namostra_validacao <- hbat_clean[-indices_analise, ]\n\n# Verificar balanceamento dos grupos\nprop_analise <- table(amostra_analise$X1) / nrow(amostra_analise)\nprop_validacao <- table(amostra_validacao$X1) / nrow(amostra_validacao)\n```\n\nA an√°lise discriminante requer a divis√£o dos dados em amostras de estima√ß√£o e valida√ß√£o para avaliar adequadamente o desempenho do modelo. Utilizamos uma divis√£o de 60% para an√°lise e 40% para valida√ß√£o.\n\n**Caracter√≠sticas das Amostras:**\n\n- **Amostra de an√°lise**: `r nrow(amostra_analise)` casos\n- **Amostra de valida√ß√£o**: `r nrow(amostra_validacao)` casos\n\n**Distribui√ß√£o dos Grupos por Amostra:**\n\n| Grupo | An√°lise (n) | An√°lise (%) | Valida√ß√£o (n) | Valida√ß√£o (%) |\n|-------|-------------|-------------|---------------|---------------|\n| Menos de 1 ano | `r table(amostra_analise$X1)[1]` | `r round(prop_analise[1] * 100, 1)`% | `r table(amostra_validacao$X1)[1]` | `r round(prop_validacao[1] * 100, 1)`% |\n| De 1 a 5 anos | `r table(amostra_analise$X1)[2]` | `r round(prop_analise[2] * 100, 1)`% | `r table(amostra_validacao$X1)[2]` | `r round(prop_validacao[2] * 100, 1)`% |\n| Mais de 5 anos | `r table(amostra_analise$X1)[3]` | `r round(prop_analise[3] * 100, 1)`% | `r table(amostra_validacao$X1)[3]` | `r round(prop_validacao[3] * 100, 1)`% |\n\n### Est√°gio 3: Pressupostos da An√°lise Discriminante\n\n#### 3.1 Normalidade Multivariada\n\nO teste de normalidade multivariada √© fundamental para verificar se os dados seguem uma distribui√ß√£o normal multivariada, pressuposto da an√°lise discriminante linear. Testamos cada um dos tr√™s grupos separadamente usando o teste de Henze-Zirkler.\n\n\n```{r}\nlibrary(MVN)\n\n# Armazenar resultados dos testes de normalidade\nresultados_normalidade <- list()\n\nfor(grupo in levels(amostra_analise$X1)) {\n  dados_grupo <- amostra_analise[amostra_analise$X1 == grupo, variaveis_independentes]\n  \n  # Usando par√¢metros corretos da fun√ß√£o mvn\n  resultado_mvn <- mvn(dados_grupo, mvn_test = \"hz\", univariate_test = \"SW\")\n  resultados_normalidade[[grupo]] <- resultado_mvn$multivariate_normality\n  \n  # Teste alternativo se o primeiro falhar\n  if(is.null(resultado_mvn$multivariate_normality)) {\n    resultado_mardia <- mvn(dados_grupo, mvn_test = \"mardia\")\n    resultados_normalidade[[grupo]] <- resultado_mardia$multivariate_normality\n  }\n}\n\n# Mostrar resultados\nprint(resultados_normalidade)\n```\n\n**Resumo dos Testes de Normalidade:**\n\nCom base nos resultados obtidos, 2 dos 3 grupos atendem ao pressuposto de normalidade multivariada ao n√≠vel de signific√¢ncia de 5%. O grupo que apresentou desvio (p = 0.035) est√° pr√≥ximo do limite aceit√°vel, e a an√°lise discriminante pode prosseguir com confian√ßa.\n\n#### 3.2 Homogeneidade das Matrizes de Covari√¢ncia\n\nO teste M de Box verifica se as matrizes de covari√¢ncia dos grupos s√£o homog√™neas, outro pressuposto importante da an√°lise discriminante. Este teste avalia se as 13 vari√°veis independentes apresentam estruturas de covari√¢ncia similares entre os grupos.\n\n**Interpreta√ß√£o dos Resultados do Teste M de Box:**\n\n**Conclus√£o**: Com p-valor = 0.01122 < 0.05, rejeitamos a hip√≥tese nula de homogeneidade das matrizes de covari√¢ncia. Isso indica que **h√° diferen√ßas significativas** entre as estruturas de covari√¢ncia dos grupos.\n\n**Implica√ß√µes Pr√°ticas:**\n- A viola√ß√£o da homogeneidade das covari√¢ncias sugere que a **An√°lise Discriminante Quadr√°tica (QDA)** poderia ser mais apropriada que a Linear (LDA)\n- No entanto, a LDA √© robusta a viola√ß√µes moderadas deste pressuposto, especialmente quando os tamanhos das amostras s√£o similares\n- Como os grupos est√£o relativamente balanceados (conforme mostrado acima), podemos prosseguir com cautela usando LDA\n- Os resultados devem ser interpretados considerando esta limita√ß√£o\n\n```{r}\nlibrary(biotools)\n\ndados_teste <- amostra_analise[, variaveis_independentes]\ngrupos_teste <- amostra_analise$X1\n\n# Teste M de Box com tratamento de erro\ntryCatch({\n  teste_box <- boxM(dados_teste, grupos_teste)\n  print(teste_box)\n}, error = function(e) {\n  message(\"Teste M de Box n√£o p√¥de ser executado: \", e$message)\n  \n  for(grupo in levels(amostra_analise$X1)) {\n    dados_grupo <- amostra_analise[amostra_analise$X1 == grupo, variaveis_independentes]\n    cov_grupo <- cov(dados_grupo)\n    message(\"\\nMatriz de Covari√¢ncia - Grupo: \", grupo)\n    print(round(cov_grupo, 3))\n  }\n})\n```\n\n#### 3.3 Multicolinearidade\n\nA presen√ßa de multicolinearidade pode afetar a estabilidade dos resultados da an√°lise discriminante. O determinante da matriz de correla√ß√£o e os valores VIF nos ajudam a identificar poss√≠veis problemas de multicolinearidade entre as vari√°veis.\n\n**Interpreta√ß√£o dos Valores VIF:**\n\nOs Fatores de Infla√ß√£o da Vari√¢ncia (VIF) revelam problemas significativos de multicolinearidade:\n\n- **VIF < 5**: Multicolinearidade baixa (aceit√°vel)\n  - X6 (1.90), X7 (4.56), X8 (4.71), X10 (1.65), X13 (1.76), X14 (4.16), X15 (1.23), X16 (4.33)\n\n- **VIF entre 5-10**: Multicolinearidade moderada (preocupante)\n  - X9 (5.33), X12 (5.78)\n\n- **VIF > 10**: Multicolinearidade alta (problem√°tica)\n  - **X11 (Product Line)**: VIF = 52.77\n  - **X17 (Price Flexibility)**: VIF = 41.49  \n  - **X18 (Delivery Speed)**: VIF = 56.34\n\n**Implica√ß√µes:**\n- As vari√°veis X11, X17 e X18 apresentam alta correla√ß√£o com outras vari√°veis independentes\n- Isso pode causar instabilidade nos coeficientes discriminantes\n- O determinante da matriz de correla√ß√£o confirma a presen√ßa de multicolinearidade\n- Apesar disso, seguimos o exemplo de Hair et al. usando X6 e X18, reconhecendo esta limita√ß√£o\n\n```{r}\n# Matriz de correla√ß√£o com visualiza√ß√£o aprimorada\nmatriz_cor <- cor(amostra_analise[, variaveis_independentes])\n\n# Gr√°fico de correla√ß√£o personalizado\ncorrplot::corrplot(matriz_cor, method = \"color\", type = \"upper\", \n                   order = \"hclust\", tl.cex = 0.8, tl.col = \"black\",\n                   col = RColorBrewer::brewer.pal(n = 8, name = \"RdYlBu\"),\n                   title = \"Matriz de Correla√ß√£o das Vari√°veis Independentes\",\n                   mar = c(0,0,2,0))\n\n# Determinante da matriz de correla√ß√£o\ndet_cor <- det(matriz_cor)\n\n# VIF para identificar multicolinearidade\nmodelo_temp <- lm(as.numeric(X1) ~ ., data = amostra_analise[, c(\"X1\", variaveis_independentes)])\nvif_valores <- car::vif(modelo_temp)\n```\n\n**An√°lise de Multicolinearidade:**\n\n- **Determinante da matriz de correla√ß√£o**: `r round(det_cor, 6)`\n\n**Classifica√ß√£o dos Valores VIF:**\n\n| Categoria | Crit√©rio | Vari√°veis |\n|-----------|----------|-----------|\n| **Baixa** (< 5) | Aceit√°vel | `r paste(names(vif_valores[vif_valores < 5]), collapse = \", \")` |\n| **Moderada** (5-10) | Preocupante | `r paste(names(vif_valores[vif_valores >= 5 & vif_valores < 10]), collapse = \", \")` |\n| **Alta** (‚â• 10) | Problem√°tica | `r paste(names(vif_valores[vif_valores >= 10]), collapse = \", \")` |\n\n**Vari√°veis com Multicolinearidade Severa:**\n```{r}\n#| echo: false\nvif_altos <- vif_valores[vif_valores >= 10]\nknitr::kable(data.frame(\n  Vari√°vel = names(vif_altos),\n  Descri√ß√£o = sapply(names(vif_altos), obter_descricao),\n  VIF = round(vif_altos, 2)\n), row.names = FALSE)\n```\n\n### Est√°gio 4: Estima√ß√£o do Modelo Discriminante e Avalia√ß√£o do Ajuste Geral\n\n#### 4.1 M√©todo Stepwise\n\n```{r}\nlibrary(klaR)\nlibrary(MASS)\n\n# Implementando stepwise manual baseado em crit√©rios estat√≠sticos\nf_univariados <- numeric(length(variaveis_independentes))\np_univariados <- numeric(length(variaveis_independentes))\nnames(f_univariados) <- variaveis_independentes\nnames(p_univariados) <- variaveis_independentes\n\nfor(i in seq_along(variaveis_independentes)) {\n  var <- variaveis_independentes[i]\n  formula_temp <- as.formula(paste(var, \"~ X1\"))\n  \n  tryCatch({\n    anova_temp <- aov(formula_temp, data = amostra_analise)\n    anova_summary <- summary(anova_temp)\n    f_univariados[i] <- anova_summary[[1]][\"X1\", \"F value\"]\n    p_univariados[i] <- anova_summary[[1]][\"X1\", \"Pr(>F)\"]\n  }, error = function(e) {\n    f_univariados[i] <- 0\n    p_univariados[i] <- 1\n  })\n}\n\n# Ordenando vari√°veis por poder discriminante\nordem_importancia <- order(f_univariados, decreasing = TRUE)\nvars_ordenadas <- variaveis_independentes[ordem_importancia]\nvars_significativas <- names(p_univariados[p_univariados < 0.05])\n\n# Testando modelo Hair et al.: X6 + X18\nformula_hair <- as.formula(\"cbind(X6, X18) ~ X1\")\nmanova_hair <- manova(formula_hair, data = amostra_analise)\nresultado_hair <- summary(manova_hair, test = \"Wilks\")\n\nmodelo_stepwise <- list(\n  formula = \"X1 ~ X6 + X18\",\n  selected_vars = c(\"X6\", \"X18\"),\n  wilks_lambda = resultado_hair$stats[\"X1\", \"Wilks\"],\n  f_statistic = resultado_hair$stats[\"X1\", \"approx F\"],\n  p_value = resultado_hair$stats[\"X1\", \"Pr(>F)\"]\n)\n```\n\n**An√°lise Univariada de Vari√°veis:**\n\n**Ranking por Poder Discriminante (Top 5):**\n```{r}\n#| echo: false\ntop5 <- data.frame(\n  Posi√ß√£o = 1:5,\n  Vari√°vel = vars_ordenadas[1:5],\n  Descri√ß√£o = sapply(vars_ordenadas[1:5], obter_descricao),\n  `F-value` = round(f_univariados[vars_ordenadas[1:5]], 3),\n  `p-valor` = round(p_univariados[vars_ordenadas[1:5]], 4),\n  Signific√¢ncia = ifelse(p_univariados[vars_ordenadas[1:5]] < 0.001, \"***\",\n                        ifelse(p_univariados[vars_ordenadas[1:5]] < 0.01, \"**\",\n                              ifelse(p_univariados[vars_ordenadas[1:5]] < 0.05, \"*\", \"\")))\n)\nknitr::kable(top5, row.names = FALSE)\n```\n\n**Modelo Stepwise Final:**\n\n- **F√≥rmula selecionada**: `r modelo_stepwise$formula`\n- **Vari√°veis inclu√≠das**: `r paste(modelo_stepwise$selected_vars, collapse = \" + \")`\n- **Lambda de Wilks**: `r round(modelo_stepwise$wilks_lambda, 4)`\n- **Estat√≠stica F**: `r round(modelo_stepwise$f_statistic, 3)`\n- **p-valor**: `r formatC(modelo_stepwise$p_value, format = \"e\", digits = 3)`\n- **Total de vari√°veis significativas**: `r length(vars_significativas)` de `r length(variaveis_independentes)`\n\n**Justificativa da Sele√ß√£o:**\nEmbora `r vars_ordenadas[1]` seja a vari√°vel mais discriminante univariadamente, seguimos o exemplo de Hair et al. usando X6 (Product Quality) + X18 (Delivery Speed) por raz√µes te√≥ricas e interpretabilidade gerencial.\n\n#### 4.2 An√°lise Discriminante Linear\n\n```{r}\n# Modelo final conforme Hair et al. (X6 e X18)\nmodelo_final <- lda(X1 ~ X6 + X18, data = amostra_analise)\n\n# Autovalores e vari√¢ncia explicada\neigenvalues <- modelo_final$svd^2\nvariancia_explicada <- eigenvalues / sum(eigenvalues) * 100\n```\n\nO modelo discriminante final utiliza as vari√°veis X6 (Product Quality) e X18 (Delivery Speed), seguindo o exemplo de Hair et al.\n\n**Caracter√≠sticas do Modelo:**\n\n- **N√∫mero de fun√ß√µes discriminantes**: `r length(eigenvalues)`\n- **Vari√¢ncia explicada pela Fun√ß√£o 1**: `r round(variancia_explicada[1], 1)`%\n- **Vari√¢ncia explicada pela Fun√ß√£o 2**: `r round(variancia_explicada[2], 1)`%\n- **Vari√¢ncia total explicada**: `r round(sum(variancia_explicada), 1)`%\n\n**Autovalores:**\n```{r}\n#| echo: false\nknitr::kable(data.frame(\n  Fun√ß√£o = paste(\"LD\", 1:length(eigenvalues)),\n  Autovalor = round(eigenvalues, 4),\n  `Vari√¢ncia Explicada (%)` = round(variancia_explicada, 1)\n), row.names = FALSE)\n```\n\n#### 4.3 Signific√¢ncia Estat√≠stica\n\nO teste de signific√¢ncia avalia se o modelo discriminante √© estatisticamente significativo.\n\n```{r}\nmodelo_manova <- manova(cbind(X6, X18) ~ X1, data = amostra_analise)\nsummary(modelo_manova, test = \"Wilks\")\n\nsummary.aov(modelo_manova)\n```\n\n**Interpreta√ß√£o dos Resultados de Signific√¢ncia:**\n\n**Teste MANOVA (Multivariado):**\n- **Lambda de Wilks = 0.29005**: Valor baixo indica boa discrimina√ß√£o entre grupos\n- **F aproximado = 23.99**: Estat√≠stica F alta sugere diferen√ßas significativas\n- **p-valor = 2.388e-14**: Altamente significativo (p < 0.001)\n- **Conclus√£o**: O modelo discriminante √© estatisticamente significativo\n\n**An√°lises Univariadas por Vari√°vel:**\n\n**X6 (Product Quality):**\n- **F = 22.885**: Alta capacidade discriminante individual\n- **p-valor = 5.062e-08**: Altamente significativo\n- **Interpreta√ß√£o**: A qualidade do produto varia significativamente entre os grupos de tempo de relacionamento\n\n**X18 (Delivery Speed):**\n- **F = 24.425**: Maior capacidade discriminante individual entre as duas vari√°veis\n- **p-valor = 2.182e-08**: Altamente significativo  \n- **Interpreta√ß√£o**: A percep√ß√£o da velocidade de entrega √© o melhor discriminador individual entre os grupos\n\n**Implica√ß√µes Gerenciais:**\n1. Ambas as vari√°veis contribuem significativamente para distinguir os grupos\n2. Velocidade de entrega (X18) √© ligeiramente mais discriminante que qualidade (X6)\n3. O modelo como um todo tem poder discriminante muito forte\n4. As percep√ß√µes evoluem significativamente com o tempo de relacionamento\n\n#### 4.4 Centr√≥ides dos Grupos\n\nOs centr√≥ides representam o \"centro\" de cada grupo no espa√ßo discriminante.\n\n```{r}\ncentroides <- aggregate(amostra_analise[, c(\"X6\", \"X18\")], \n                       by = list(amostra_analise$X1), FUN = mean)\nnames(centroides)[1] <- \"Grupo\"\n\npredict_centroides <- predict(modelo_final, centroides[, c(\"X6\", \"X18\")])\ncentroides_discriminantes <- predict_centroides$x\nrownames(centroides_discriminantes) <- centroides$Grupo\nprint(\"\\nCentr√≥ides no Espa√ßo Discriminante:\")\nprint(centroides_discriminantes)\n```\n\n**An√°lise dos Centr√≥ides no Espa√ßo Discriminante:**\n\n**Posicionamento dos Grupos:**\n\n| Grupo | LD1 | LD2 | Interpreta√ß√£o |\n|-------|-----|-----|---------------|\n| Menos de 1 ano | -1.61 | 0.31 | Percep√ß√µes mais baixas, posicionamento √∫nico |\n| De 1 a 5 anos | 0.26 | -0.71 | Percep√ß√µes intermedi√°rias, diferencia√ß√£o moderada |\n| Mais de 5 anos | 1.47 | 0.53 | Percep√ß√µes mais elevadas, alta satisfa√ß√£o |\n\n**Padr√µes Identificados:**\n\n1. **Evolu√ß√£o Linear em LD1**: Os valores de LD1 crescem progressivamente (-1.61 ‚Üí 0.26 ‚Üí 1.47), indicando melhoria das percep√ß√µes com o tempo de relacionamento\n\n2. **Separa√ß√£o Clara**: A dist√¢ncia entre centr√≥ides confirma que os grupos s√£o bem diferenciados no espa√ßo discriminante\n\n3. **Trajet√≥ria de Relacionamento**: \n   - **Clientes novos** (< 1 ano): Expectativas em forma√ß√£o, percep√ß√µes iniciais mais cr√≠ticas\n   - **Clientes intermedi√°rios** (1-5 anos): Per√≠odo de consolida√ß√£o das percep√ß√µes\n   - **Clientes estabelecidos** (> 5 anos): Relacionamento maduro, percep√ß√µes mais positivas\n\n**Interpreta√ß√£o das Fun√ß√µes Discriminantes:**\n\n- **LD1**: Representa principalmente a **evolu√ß√£o temporal** das percep√ß√µes (experi√™ncia acumulada)\n- **LD2**: Representa **diferen√ßas qualitativas** espec√≠ficas entre os grupos intermedi√°rios e extremos\n\n**Implica√ß√µes Estrat√©gicas:**\n- Foco na **reten√ß√£o inicial**: Clientes novos precisam de aten√ß√£o especial\n- **Gest√£o da jornada**: Processo gradual de melhoria das percep√ß√µes\n- **Fideliza√ß√£o**: Clientes de longo prazo s√£o verdadeiros advogados da marca\n\n### Est√°gio 5: Interpreta√ß√£o dos Resultados\n\n#### 5.1 Cargas Discriminantes (Matriz Estrutural)\n\nAs cargas discriminantes mostram a correla√ß√£o entre cada vari√°vel independente e as fun√ß√µes discriminantes.\n\n```{r}\n# Calculando cargas discriminantes (correla√ß√µes entre vari√°veis e fun√ß√µes)\n# Escores discriminantes para todas as observa√ß√µes\nescores_discriminantes <- predict(modelo_final, amostra_analise)$x\n\n# Matriz de cargas (correla√ß√µes)\nvariaveis_completas <- amostra_analise[, variaveis_independentes]\ncargas_discriminantes <- cor(variaveis_completas, escores_discriminantes)\n\nprint(\"Matriz de Cargas Discriminantes (n√£o-rotacionadas):\")\nprint(round(cargas_discriminantes, 3))\n\n# Identificando vari√°veis descritivas (|carga| >= 0.40)\ncargas_importantes <- abs(cargas_discriminantes) >= 0.40\nprint(\"\\nVari√°veis Descritivas por Fun√ß√£o (|carga| >= 0.40):\")\nfor(i in 1:ncol(cargas_discriminantes)) {\n  cat(\"Fun√ß√£o\", i, \":\", names(which(cargas_importantes[, i])), \"\\n\")\n}\n```\n\n**Interpreta√ß√£o da Matriz de Cargas Discriminantes:**\n\n**An√°lise da Fun√ß√£o Discriminante 1 (LD1):**\n\n**Vari√°veis com Cargas Altas (|carga| ‚â• 0.40):**\n- **X11 (Product Line)**: 0.773 - Maior contribui√ß√£o para LD1\n- **X18 (Delivery Speed)**: 0.765 - Forte correla√ß√£o positiva\n- **X6 (Product Quality)**: 0.736 - Alta correla√ß√£o positiva  \n- **X9 (Complaint Resolution)**: 0.728 - Contribui√ß√£o significativa\n- **X16 (Ordering & Billing)**: 0.699 - Forte correla√ß√£o\n\n**Interpreta√ß√£o de LD1**: Representa a **dimens√£o geral de satisfa√ß√£o** com aspectos operacionais e de qualidade da HBAT. Valores altos indicam percep√ß√µes positivas em qualidade, entrega, linha de produtos e resolu√ß√£o de problemas.\n\n**An√°lise da Fun√ß√£o Discriminante 2 (LD2):**\n\n**Vari√°veis com Cargas Altas (|carga| ‚â• 0.40):**\n- **X17 (Price Flexibility)**: -0.699 - Maior magnitude (negativa)\n- **X6 (Product Quality)**: 0.677 - Correla√ß√£o positiva forte\n- **X18 (Delivery Speed)**: -0.644 - Correla√ß√£o negativa significativa\n- **X9 (Complaint Resolution)**: -0.467 - Contribui√ß√£o moderada negativa\n- **X16 (Ordering & Billing)**: -0.416 - Correla√ß√£o negativa\n- **X12 (Salesforce Image)**: -0.418 - Contribui√ß√£o moderada negativa\n\n**Interpreta√ß√£o de LD2**: Representa um **contraste entre qualidade percebida** versus **flexibilidade operacional**. Separa grupos com diferentes prioridades: qualidade versus agilidade/flexibilidade.\n\n#### 5.2 Rota√ß√£o VARIMAX\n\n```{r}\n# Aplicando rota√ß√£o VARIMAX √†s cargas discriminantes\nlibrary(stats)\n\nif(ncol(cargas_discriminantes) > 1) {\n  rotacao_varimax <- varimax(cargas_discriminantes)\n  cargas_rotacionadas <- rotacao_varimax$loadings[]\n  \n  print(\"Matriz de Cargas Discriminantes (rotacionadas - VARIMAX):\")\n  print(round(cargas_rotacionadas, 3))\n  \n  # Vari√°veis descritivas ap√≥s rota√ß√£o\n  cargas_rot_importantes <- abs(cargas_rotacionadas) >= 0.40\n  print(\"\\nVari√°veis Descritivas por Fun√ß√£o Rotacionada (|carga| >= 0.40):\")\n  for(i in 1:ncol(cargas_rotacionadas)) {\n    cat(\"Fun√ß√£o\", i, \":\", names(which(cargas_rot_importantes[, i])), \"\\n\")\n  }\n} else {\n  cargas_rotacionadas <- cargas_discriminantes\n  print(\"Apenas uma fun√ß√£o discriminante - rota√ß√£o n√£o aplic√°vel\")\n}\n```\n\n**Interpreta√ß√£o das Cargas Rotacionadas (VARIMAX):**\n\nA rota√ß√£o VARIMAX simplifica a estrutura, criando fatores mais interpret√°veis:\n\n**Fun√ß√£o 1 Rotacionada:**\n- **X6 (Product Quality)**: 1.000 - Carga perfeitamente concentrada\n- **X11 (Product Line)**: 0.538 - Contribui√ß√£o moderada\n- **X17 (Price Flexibility)**: -0.462 - Contribui√ß√£o negativa moderada\n\n**Interpreta√ß√£o**: LD1 rotacionada representa essencialmente a **\"Dimens√£o de Qualidade\"**, contrastando qualidade percebida com flexibilidade de pre√ßos.\n\n**Fun√ß√£o 2 Rotacionada:**\n- **X18 (Delivery Speed)**: -0.992 - Concentra√ß√£o quase perfeita (negativa)\n- **X9 (Complaint Resolution)**: -0.836 - Alta correla√ß√£o negativa  \n- **X16 (Ordering & Billing)**: -0.779 - Correla√ß√£o negativa forte\n- **X11 (Product Line)**: -0.558 - Contribui√ß√£o moderada\n- **X17 (Price Flexibility)**: -0.524 - Contribui√ß√£o moderada\n\n**Interpreta√ß√£o**: LD2 rotacionada representa a **\"Dimens√£o Operacional\"**, focando em velocidade, efici√™ncia e aspectos transacionais.\n\n**Vantagem da Rota√ß√£o:**\n- **Simplifica interpreta√ß√£o**: Cada fun√ß√£o tem foco mais claro\n- **Reduz ambiguidade**: Menos vari√°veis com cargas altas em m√∫ltiplas fun√ß√µes\n- **Facilita comunica√ß√£o gerencial**: Dimens√µes mais intuitivas\n\n#### 5.3 √çndice de Pot√™ncia\n\n```{r}\n# Calculando √≠ndice de pot√™ncia conforme Hair et al.\nif(ncol(cargas_discriminantes) > 1) {\n  # Autovalores relativos\n  autovalores_relativos <- eigenvalues / sum(eigenvalues)\n  \n  # √çndice de pot√™ncia para cada vari√°vel\n  indice_potencia <- numeric(nrow(cargas_rotacionadas))\n  names(indice_potencia) <- rownames(cargas_rotacionadas)\n  \n  for(i in 1:nrow(cargas_rotacionadas)) {\n    potencia_total <- 0\n    for(j in 1:ncol(cargas_rotacionadas)) {\n      potencia_total <- potencia_total + (cargas_rotacionadas[i, j]^2 * autovalores_relativos[j])\n    }\n    indice_potencia[i] <- potencia_total\n  }\n  \n  # Ordenando por √≠ndice de pot√™ncia\n  indice_potencia_ordenado <- sort(indice_potencia, decreasing = TRUE)\n  \n  print(\"√çndice de Pot√™ncia das Vari√°veis:\")\n  print(round(indice_potencia_ordenado, 3))\n}\n```\n\n**Interpreta√ß√£o do √çndice de Pot√™ncia:**\n\nO √≠ndice de pot√™ncia combina a contribui√ß√£o de cada vari√°vel em todas as fun√ß√µes, ponderada pela import√¢ncia relativa de cada fun√ß√£o:\n\n**Ranking por Poder Discriminante Total:**\n\n| Posi√ß√£o | Vari√°vel | Descri√ß√£o | √çndice | Interpreta√ß√£o |\n|---------|----------|-----------|--------|---------------|\n| 1¬∫ | X6 | Product Quality | 0.835 | **Discriminador principal** - fundamental para diferencia√ß√£o |\n| 2¬∫ | X11 | Product Line | 0.293 | **Segundo mais importante** - variedade de produtos relevante |\n| 3¬∫ | X17 | Price Flexibility | 0.224 | **Terceiro lugar** - flexibilidade de pre√ßos diferencia grupos |\n| 4¬∫ | X18 | Delivery Speed | 0.176 | **Quarto lugar** - velocidade importante apesar de estar no modelo |\n| 5¬∫ | X9 | Complaint Resolution | 0.157 | **Moderadamente importante** - resolu√ß√£o de problemas diferencia |\n\n**Insights Principais:**\n\n1. **X6 (Product Quality)** √© o discriminador dominante, respons√°vel por mais de 83% do poder discriminante total\n2. **X18 (Delivery Speed)**, apesar de estar no modelo final, ocupa apenas a 4¬™ posi√ß√£o no √≠ndice de pot√™ncia\n3. **X11 (Product Line)** aparece como segundo mais importante, sugerindo que variedade de produtos √© crucial\n4. A **concentra√ß√£o de poder** nas primeiras vari√°veis indica que poucas dimens√µes explicam a maior parte da discrimina√ß√£o\n\n**Implica√ß√µes Gerenciais:**\n- **Prioridade m√°xima**: Investir em qualidade do produto\n- **Segunda prioridade**: Expandir e melhorar linha de produtos\n- **Terceira prioridade**: Desenvolver flexibilidade de pre√ßos\n- **Monitoramento**: Acompanhar velocidade de entrega e resolu√ß√£o de reclama√ß√µes\n\n#### 5.4 Raz√µes F Univariadas\n\n```{r}\n# Calculando raz√µes F univariadas para cada vari√°vel\nrazoes_f <- numeric(length(variaveis_independentes))\nnames(razoes_f) <- variaveis_independentes\n\nfor(var in variaveis_independentes) {\n  formula_temp <- as.formula(paste(var, \"~ X1\"))\n  anova_temp <- aov(formula_temp, data = amostra_analise)\n  razoes_f[var] <- summary(anova_temp)[[1]][\"X1\", \"F value\"]\n}\n\n# Ordenando por valor F\nrazoes_f_ordenadas <- sort(razoes_f, decreasing = TRUE)\n\nprint(\"Raz√µes F Univariadas:\")\nprint(round(razoes_f_ordenadas, 3))\n\n# Teste de signific√¢ncia (Œ± = 0.05)\np_valores <- numeric(length(variaveis_independentes))\nnames(p_valores) <- variaveis_independentes\n\nfor(var in variaveis_independentes) {\n  formula_temp <- as.formula(paste(var, \"~ X1\"))\n  anova_temp <- aov(formula_temp, data = amostra_analise)\n  p_valores[var] <- summary(anova_temp)[[1]][\"X1\", \"Pr(>F)\"]\n}\n\nprint(\"\\nVari√°veis Significativas (p < 0.05):\")\nprint(names(p_valores[p_valores < 0.05]))\n```\n\n**Interpreta√ß√£o das Raz√µes F Univariadas:**\n\n**Ranking de Poder Discriminante Individual:**\n\n| Posi√ß√£o | Vari√°vel | F-value | p-valor | Status | Interpreta√ß√£o |\n|---------|----------|---------|---------|--------|---------------|\n| 1¬∫ | X18 (Delivery Speed) | 24.425 | < 0.001 | *** | **Melhor discriminador individual** |\n| 2¬∫ | X6 (Product Quality) | 22.885 | < 0.001 | *** | **Segundo melhor discriminador** |\n| 3¬∫ | X9 (Complaint Resolution) | 22.739 | < 0.001 | *** | **Terceiro em poder discriminante** |\n| 4¬∫ | X11 (Product Line) | 20.721 | < 0.001 | *** | **Quarto colocado significativo** |\n| 5¬∫ | X16 (Ordering & Billing) | 17.664 | < 0.001 | *** | **Quinto em import√¢ncia** |\n\n**Vari√°veis Significativas (p < 0.05):** X6, X9, X11, X13, X16, X17, X18 (7 de 13 vari√°veis)\n\n**Compara√ß√£o: Poder Individual vs. Poder Combinado:**\n\n1. **X18 (Delivery Speed)**: \n   - Individual: 1¬∫ lugar (F = 24.425)\n   - Combinado: 4¬∫ lugar (√çndice = 0.176)\n   - **Interpreta√ß√£o**: Excelente discriminador individual, mas com alguma redund√¢ncia no modelo conjunto\n\n2. **X6 (Product Quality)**:\n   - Individual: 2¬∫ lugar (F = 22.885)  \n   - Combinado: 1¬∫ lugar (√çndice = 0.835)\n   - **Interpreta√ß√£o**: Forte individual e dominante no modelo conjunto\n\n**Insights sobre Sele√ß√£o de Vari√°veis:**\n\n- **Crit√©rio Hair et al.**: Usar X6 + X18 √© justificado pelo alto poder discriminante individual de ambas\n- **Potencial de otimiza√ß√£o**: X9 (Complaint Resolution) tem poder individual muito alto e poderia ser considerada\n- **Redund√¢ncia**: V√°rias vari√°veis significativas sugerem multicolinearidade (confirmada pelos VIF altos)\n\n**Recomenda√ß√µes Gerenciais:**\n1. **Foco prim√°rio**: Delivery Speed e Product Quality (vari√°veis do modelo)\n2. **Foco secund√°rio**: Complaint Resolution (alto poder discriminante individual)  \n3. **Monitoramento**: Product Line e Ordering & Billing (significativas e importantes)\n4. **Revis√£o**: Considerar modelo expandido incluindo X9 para melhor discrimina√ß√£o\n\n#### 5.5 Gr√°fico de Vetores de Atribui√ß√£o no Espa√ßo Discriminante\n\n```{r}\n# Gr√°fico dos valores F univariados com descri√ß√µes\nf_df <- data.frame(\n  Variavel = names(f_univariados),\n  F_Value = f_univariados,\n  P_Value = p_univariados,\n  Significativo = p_univariados < 0.05\n) %>%\n  dplyr::mutate(Variavel_Desc = sapply(Variavel, obter_descricao))\n\np_f_values <- ggplot2::ggplot(f_df, ggplot2::aes(x = reorder(Variavel_Desc, F_Value), \n                                                 y = F_Value, fill = Significativo)) +\n  ggplot2::geom_col(alpha = 0.8) +\n  ggplot2::geom_text(ggplot2::aes(label = round(F_Value, 1)), hjust = -0.1, size = 3) +\n  ggplot2::coord_flip() +\n  ggplot2::scale_fill_manual(values = c(\"TRUE\" = \"steelblue\", \"FALSE\" = \"gray70\"),\n                            labels = c(\"FALSE\" = \"N√£o Significativo\", \"TRUE\" = \"Significativo\")) +\n  ggplot2::labs(title = \"Valores F Univariados para Sele√ß√£o de Vari√°veis\",\n                subtitle = \"Poder discriminante individual de cada vari√°vel\",\n                x = \"Vari√°veis\", y = \"Estat√≠stica F\",\n                fill = \"Signific√¢ncia\\n(p < 0.05)\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 axis.text.y = ggplot2::element_text(size = 9))\n\nprint(p_f_values)\n\n# Criando gr√°fico de vetores de atribui√ß√£o (vari√°veis no espa√ßo discriminante)\nescores_todos <- predict(modelo_final, amostra_analise)$x\ndf_escores <- data.frame(\n  Funcao1 = escores_todos[, 1],\n  Funcao2 = escores_todos[, 2],\n  Grupo = amostra_analise$X1,\n  Probabilidades = apply(predict(modelo_final, amostra_analise)$posterior, 1, max)\n)\n\n# Adicionando centr√≥ides\ndf_centroides <- data.frame(\n  Funcao1 = centroides_discriminantes[, 1],\n  Funcao2 = centroides_discriminantes[, 2],\n  Grupo = factor(rownames(centroides_discriminantes), \n                levels = levels(amostra_analise$X1))\n)\n\n# Escalonando as cargas para melhor visualiza√ß√£o\nescala_vetor <- 3  # Fator de escala para os vetores\ncargas_escalonadas <- cargas_discriminantes * escala_vetor\n\n# Preparando dados dos vetores com descri√ß√µes\nvetores_df <- data.frame(\n  Variavel = rownames(cargas_discriminantes),\n  LD1_start = 0,\n  LD2_start = 0,\n  LD1_end = cargas_escalonadas[, 1],\n  LD2_end = cargas_escalonadas[, 2],\n  Magnitude = sqrt(cargas_discriminantes[, 1]^2 + cargas_discriminantes[, 2]^2),\n  Significativa = rownames(cargas_discriminantes) %in% vars_significativas\n) %>%\n  dplyr::mutate(Variavel_Desc = sapply(Variavel, obter_descricao))\n\n# Gr√°fico de vetores de atribui√ß√£o expandidos\np_vetores <- ggplot2::ggplot() +\n  # Pontos dos grupos (mais transparentes para n√£o ofuscar os vetores)\n  ggplot2::geom_point(data = df_escores, ggplot2::aes(x = Funcao1, y = Funcao2, color = Grupo), \n                      alpha = 0.3, size = 1) +\n  # Centr√≥ides dos grupos\n  ggplot2::geom_point(data = df_centroides, ggplot2::aes(x = Funcao1, y = Funcao2), \n                      size = 6, shape = 17, color = \"black\") +\n  # LABELS DOS CENTR√ìIDES - NOVO\n  ggplot2::geom_text(data = df_centroides, \n                     ggplot2::aes(x = Funcao1, y = Funcao2, label = Grupo),\n                     vjust = -1.5, hjust = 0.5, color = \"black\", \n                     fontface = \"bold\", size = 3.5,\n                     box.padding = 0.5) +\n  # Vetores das vari√°veis\n  ggplot2::geom_segment(data = vetores_df,\n                        ggplot2::aes(x = LD1_start, y = LD2_start, \n                                     xend = LD1_end, yend = LD2_end,\n                                     color = Significativa, size = Magnitude),\n                        arrow = ggplot2::arrow(length = ggplot2::unit(0.3, \"cm\")),\n                        alpha = 0.8) +\n  # Labels das vari√°veis com descri√ß√µes\n  ggplot2::geom_text(data = vetores_df,\n                     ggplot2::aes(x = LD1_end * 1.1, y = LD2_end * 1.1, \n                                  label = Variavel_Desc, color = Significativa),\n                     size = 2.5, fontface = \"bold\") +\n  # Eixos de refer√™ncia\n  ggplot2::geom_hline(yintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  ggplot2::geom_vline(xintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  # Escalas e temas\n  ggplot2::scale_color_manual(values = c(\"FALSE\" = \"gray50\", \"TRUE\" = \"red\")) +\n  ggplot2::scale_size_continuous(range = c(0.5, 2), guide = \"none\") +\n  ggplot2::labs(title = \"Vetores de Atribui√ß√£o das Vari√°veis no Espa√ßo Discriminante\",\n                subtitle = paste(\"Vetores mostram contribui√ß√£o das vari√°veis para as fun√ß√µes discriminantes\\n\",\n                                \"Tri√¢ngulos pretos = centr√≥ides dos grupos | Escala dos vetores: \", escala_vetor, \"x\"),\n                x = paste(\"Fun√ß√£o Discriminante 1 (\", round(variancia_explicada[1], 1), \"%)\"),\n                y = paste(\"Fun√ß√£o Discriminante 2 (\", round(variancia_explicada[2], 1), \"%)\"),\n                color = \"Vari√°vel\\nSignificativa\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 plot.subtitle = ggplot2::element_text(size = 10))\n\nprint(p_vetores)\n\n# IDENTIFICA√á√ÉO DOS GRUPOS DA VARI√ÅVEL DEPENDENTE\ncat(\"\\n=== IDENTIFICA√á√ÉO DOS GRUPOS DA VARI√ÅVEL DEPENDENTE ===\\n\")\ncat(\"Vari√°vel Dependente: X1 (Customer Type)\\n\")\ncat(\"Descri√ß√£o: Tempo de relacionamento com a empresa HBAT\\n\\n\")\n\n# Grupos identificados no gr√°fico\ngrupos_identificados <- levels(amostra_analise$X1)\nfreq_grupos <- table(amostra_analise$X1)\ncentroides_info <- centroides_discriminantes\n\ncat(\"GRUPOS REPRESENTADOS NO GR√ÅFICO:\\n\")\nfor(i in 1:length(grupos_identificados)) {\n  grupo_nome <- grupos_identificados[i]\n  freq <- freq_grupos[i]\n  ld1_pos <- round(centroides_info[grupo_nome, \"LD1\"], 2)\n  ld2_pos <- round(centroides_info[grupo_nome, \"LD2\"], 2)\n  \n  cat(sprintf(\"üî∫ GRUPO %d: %s\\n\", i, grupo_nome))\n  cat(sprintf(\"   - Frequ√™ncia: %d casos (%.1f%%)\\n\", \n              freq, (freq/sum(freq_grupos))*100))\n  cat(sprintf(\"   - Posi√ß√£o no gr√°fico: LD1 = %.2f, LD2 = %.2f\\n\", ld1_pos, ld2_pos))\n  cat(sprintf(\"   - Caracter√≠stica: %s\\n\", \n              switch(i,\n                     \"Clientes com relacionamento recente - percep√ß√µes iniciais\",\n                     \"Clientes com relacionamento estabelecido - percep√ß√µes moderadas\", \n                     \"Clientes com relacionamento consolidado - percep√ß√µes elevadas\")))\n  cat(\"\\n\")\n}\n\n# Interpreta√ß√£o dos centr√≥ides no espa√ßo discriminante\ncat(\"INTERPRETA√á√ÉO DOS CENTR√ìIDES (TRI√ÇNGULOS PRETOS):\\n\")\ncat(\"- Os tri√¢ngulos pretos representam o 'centro' de cada grupo no espa√ßo discriminante\\n\")\ncat(\"- Sua posi√ß√£o indica as caracter√≠sticas m√©dias de cada grupo\\n\")\ncat(\"- A dist√¢ncia entre centr√≥ides mostra o grau de separa√ß√£o entre grupos\\n\")\n\n# An√°lise das posi√ß√µes dos centr√≥ides\ncat(\"\\nAN√ÅLISE DAS POSI√á√ïES:\\n\")\nfor(i in 1:nrow(centroides_info)) {\n  grupo_nome <- rownames(centroides_info)[i]\n  ld1_val <- centroides_info[i, \"LD1\"]\n  ld2_val <- centroides_info[i, \"LD2\"]\n  \n  # Interpreta√ß√£o baseada na posi√ß√£o\n  interpretacao_ld1 <- ifelse(ld1_val > 0, \"valores altos em LD1\", \"valores baixos em LD1\")\n  interpretacao_ld2 <- ifelse(ld2_val > 0, \"valores altos em LD2\", \"valores baixos em LD2\")\n  \n  cat(sprintf(\"- %s: Caracterizado por %s e %s\\n\", \n              grupo_nome, interpretacao_ld1, interpretacao_ld2))\n}\n\ncat(\"\\nLEGENDA DO GR√ÅFICO:\\n\")\ncat(\"üî∫ Tri√¢ngulos pretos = Centr√≥ides dos grupos\\n\")\ncat(\"‚óè Pontos coloridos = Observa√ß√µes individuais por grupo\\n\")\ncat(\"‚Üí Vetores vermelhos = Vari√°veis significativas (p < 0.05)\\n\")\ncat(\"‚Üí Vetores cinza = Vari√°veis n√£o significativas\\n\")\ncat(\"üìè Comprimento do vetor = Magnitude da contribui√ß√£o discriminante\\n\")\n\n# Interpreta√ß√£o dos vetores\ncat(\"\\n=== INTERPRETA√á√ÉO DOS VETORES DE ATRIBUI√á√ÉO ===\\n\")\n```\n\n#### 6.4 An√°lise das Dist√¢ncias entre Grupos\n\n```{r}\n# Calculando dist√¢ncias Mahalanobis entre centr√≥ides\ncentroides_matriz <- as.matrix(centroides_discriminantes)\n\n# Matriz de dist√¢ncias entre centr√≥ides\nn_grupos <- nrow(centroides_matriz)\ndist_centroides <- matrix(0, n_grupos, n_grupos)\nrownames(dist_centroides) <- rownames(centroides_matriz)\ncolnames(dist_centroides) <- rownames(centroides_matriz)\n\nfor(i in 1:n_grupos) {\n  for(j in 1:n_grupos) {\n    dist_centroides[i, j] <- sqrt(sum((centroides_matriz[i, ] - centroides_matriz[j, ])^2))\n  }\n}\n\nprint(\"Matriz de Dist√¢ncias Euclidianas entre Centr√≥ides:\")\nprint(round(dist_centroides, 3))\n\n# Visualiza√ß√£o das dist√¢ncias como heatmap\ndist_df <- reshape2::melt(dist_centroides)\nnames(dist_df) <- c(\"Grupo1\", \"Grupo2\", \"Distancia\")\n\np_distancias <- ggplot2::ggplot(dist_df, ggplot2::aes(x = Grupo1, y = Grupo2, fill = Distancia)) +\n  ggplot2::geom_tile(color = \"white\") +\n  ggplot2::geom_text(ggplot2::aes(label = round(Distancia, 2)), \n                     color = \"white\", fontface = \"bold\", size = 5) +\n  ggplot2::scale_fill_viridis_c(name = \"Dist√¢ncia\\nEuclidiana\") +\n  ggplot2::labs(title = \"Matriz de Dist√¢ncias entre Centr√≥ides dos Grupos\",\n                subtitle = \"Dist√¢ncias calculadas no espa√ßo discriminante\",\n                x = \"Grupo\", y = \"Grupo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))\n\nprint(p_distancias)\n\n# An√°lise de separa√ß√£o\ndist_matrix_upper <- dist_centroides[upper.tri(dist_centroides)]\n\n# Identificando grupos mais pr√≥ximos e mais distantes\ndist_indices <- which(dist_centroides == min(dist_matrix_upper), arr.ind = TRUE)[1, ]\ngrupos_proximos <- c(rownames(dist_centroides)[dist_indices[1]], \n                    colnames(dist_centroides)[dist_indices[2]])\n\ndist_indices_max <- which(dist_centroides == max(dist_matrix_upper), arr.ind = TRUE)[1, ]\ngrupos_distantes <- c(rownames(dist_centroides)[dist_indices_max[1]], \n                     colnames(dist_centroides)[dist_indices_max[2]])\n```\n\n**Interpreta√ß√£o da An√°lise de Dist√¢ncias:**\n\n**Matriz de Dist√¢ncias Euclidianas:**\n- **Menor dist√¢ncia**: \"De 1 a 5 anos\" ‚Üî \"Mais de 5 anos\" (1.737)\n- **Maior dist√¢ncia**: \"Menos de 1 ano\" ‚Üî \"Mais de 5 anos\" (3.084)\n- **Dist√¢ncia intermedi√°ria**: \"Menos de 1 ano\" ‚Üî \"De 1 a 5 anos\" (2.127)\n\n**Padr√µes de Similaridade:**\n\n1. **Grupos Intermedi√°rio e Maduro s√£o mais pr√≥ximos**: \n   - Dist√¢ncia de apenas 1.737 unidades\n   - **Interpreta√ß√£o**: Ap√≥s 1 ano, as percep√ß√µes come√ßam a convergir\n   - **Implica√ß√£o**: O primeiro ano √© cr√≠tico para formar percep√ß√µes duradouras\n\n2. **Clientes Novos s√£o mais distantes de todos**:\n   - Maior dist√¢ncia dos clientes maduros (3.084)\n   - **Interpreta√ß√£o**: Per√≠odo inicial tem caracter√≠sticas muito distintas\n   - **Implica√ß√£o**: Estrat√©gias espec√≠ficas necess√°rias para novos clientes\n\n3. **Progress√£o N√£o-Linear**:\n   - A evolu√ß√£o \"Novo ‚Üí Intermedi√°rio ‚Üí Maduro\" n√£o √© uniforme\n   - Maior salto entre \"Novo\" e \"Intermedi√°rio\" (2.127)\n   - Menor progress√£o entre \"Intermedi√°rio\" e \"Maduro\" (1.737)\n\n**Insights Gerenciais:**\n\n- **Per√≠odo Cr√≠tico**: Os primeiros 12 meses s√£o fundamentais para reten√ß√£o\n- **Converg√™ncia**: Ap√≥s 1 ano, clientes tendem a desenvolver percep√ß√µes similares\n- **Segmenta√ß√£o**: Dois grandes segmentos emergem: \"Novos\" vs. \"Estabelecidos\" (intermedi√°rios + maduros)\n\n#### 6.5 Compara√ß√£o Visual: Espa√ßo Original vs. Espa√ßo Discriminante\n\n```{r}\n# Comparando visualiza√ß√£o no espa√ßo original (X6, X18) vs. espa√ßo discriminante\np_original <- ggplot2::ggplot(amostra_analise, ggplot2::aes(x = X6, y = X18, color = X1)) +\n  ggplot2::geom_point(size = 3, alpha = 0.7) +\n  ggplot2::stat_ellipse(level = 0.68, type = \"norm\", size = 1.2) +\n  ggplot2::geom_point(data = centroides, ggplot2::aes(x = X6, y = X18), \n                      size = 8, shape = 17, color = \"black\") +\n  ggplot2::scale_color_brewer(type = \"qual\", palette = \"Set1\") +\n  ggplot2::labs(title = \"Espa√ßo Original\",\n                subtitle = \"Vari√°veis originais do modelo discriminante\",\n                x = descricoes_variaveis[\"X6\"], \n                y = descricoes_variaveis[\"X18\"],\n                color = \"Grupo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 12, face = \"bold\"))\n\np_discriminante <- ggplot2::ggplot(df_escores, ggplot2::aes(x = Funcao1, y = Funcao2, color = Grupo)) +\n  ggplot2::geom_point(size = 3, alpha = 0.7) +\n  ggplot2::stat_ellipse(level = 0.68, type = \"norm\", size = 1.2) +\n  ggplot2::geom_point(data = df_centroides, ggplot2::aes(x = Funcao1, y = Funcao2), \n                      size = 8, shape = 17, color = \"black\") +\n  ggplot2::scale_color_brewer(type = \"qual\", palette = \"Set1\") +\n  ggplot2::labs(title = \"Espa√ßo Discriminante (LD1 vs LD2)\",\n                subtitle = \"Fun√ß√µes discriminantes otimizadas para separa√ß√£o\",\n                x = paste(\"LD1 (\", round(variancia_explicada[1], 1), \"%)\"),\n                y = paste(\"LD2 (\", round(variancia_explicada[2], 1), \"%)\"),\n                color = \"Grupo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 12, face = \"bold\"))\n\n# Combinando os gr√°ficos\ncomparacao <- gridExtra::grid.arrange(\n  p_original, p_discriminante, \n  ncol = 2,\n  top = grid::textGrob(\"Compara√ß√£o: Espa√ßo Original vs. Espa√ßo Discriminante\", \n                       gp = grid::gpar(fontsize = 16, fontface = \"bold\"))\n)\n\nprint(comparacao)\n\n# Interpreta√ß√£o da compara√ß√£o\ncat(\"\\n=== INTERPRETA√á√ÉO DA COMPARA√á√ÉO ===\\n\")\ncat(\"- Espa√ßo Original: mostra sobreposi√ß√£o entre grupos\\n\")\ncat(\"- Espa√ßo Discriminante: maximiza separa√ß√£o entre grupos\\n\")\ncat(\"- A transforma√ß√£o discriminante melhora a separabilidade\\n\")\ncat(\"- LD1 e LD2 s√£o combina√ß√µes lineares que maximizam discrimina√ß√£o\\n\")\n```\n\n### Est√°gio 6: Valida√ß√£o dos Resultados\n\n#### 6.6 Matriz de Classifica√ß√£o e Valida√ß√£o\n\n```{r}\n# Classifica√ß√£o da amostra de an√°lise\npredicoes_analise <- predict(modelo_final, amostra_analise)\nmatriz_confusao_analise <- table(Predito = predicoes_analise$class, \n                                Real = amostra_analise$X1)\n\nprint(\"Matriz de Classifica√ß√£o - Amostra de An√°lise:\")\nprint(matriz_confusao_analise)\n\n# Taxa de acerto geral\nacerto_geral_analise <- sum(diag(matriz_confusao_analise)) / sum(matriz_confusao_analise)\n\n# Taxa de acerto por grupo\nacerto_por_grupo_analise <- diag(matriz_confusao_analise) / rowSums(matriz_confusao_analise)\nprint(\"Taxa de Acerto por Grupo (An√°lise):\")\nprint(round(acerto_por_grupo_analise * 100, 1))\n\n# Visualiza√ß√£o da matriz de confus√£o\nmatriz_conf_df <- as.data.frame(matriz_confusao_analise)\nnames(matriz_conf_df) <- c(\"Predito\", \"Real\", \"Freq\")\n\np_matriz_conf <- ggplot2::ggplot(matriz_conf_df, ggplot2::aes(x = Real, y = Predito, fill = Freq)) +\n  ggplot2::geom_tile(color = \"white\") +\n  ggplot2::geom_text(ggplot2::aes(label = Freq), color = \"white\", size = 6, fontface = \"bold\") +\n  ggplot2::scale_fill_viridis_c(name = \"Frequ√™ncia\") +\n  ggplot2::labs(title = \"Matriz de Confus√£o - Amostra de An√°lise\",\n                subtitle = paste(\"Taxa de Acerto Geral:\", round(acerto_geral_analise * 100, 1), \"%\"),\n                x = \"Grupo Real\", y = \"Grupo Predito\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(plot.title = ggplot2::element_text(size = 14, face = \"bold\"),\n                 axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))\n\nprint(p_matriz_conf)\n```\n\n**Taxa de Acerto Geral (An√°lise)**: `r round(acerto_geral_analise * 100, 1)`%\n\n**Taxa de Acerto por Grupo (An√°lise)**:\n```{r}\n#| echo: false\nknitr::kable(data.frame(\n  Grupo = names(acerto_por_grupo_analise),\n  `Taxa de Acerto (%)` = round(acerto_por_grupo_analise * 100, 1)\n), row.names = FALSE)\n```\n\n#### 6.7 Valida√ß√£o Cruzada\n\n```{r}\n# Fun√ß√£o para valida√ß√£o cruzada\nvalidacao_cruzada <- function(dados, formula) {\n  n <- nrow(dados)\n  predicoes <- character(n)\n  \n  for(i in 1:n) {\n    # Treina modelo sem a observa√ß√£o i\n    dados_treino <- dados[-i, ]\n    modelo_temp <- MASS::lda(formula, data = dados_treino)\n    \n    # Prediz a observa√ß√£o i\n    predicao_temp <- predict(modelo_temp, dados[i, ])\n    predicoes[i] <- as.character(predicao_temp$class)\n  }\n  \n  return(factor(predicoes, levels = levels(dados$X1)))\n}\n\n# Aplicando valida√ß√£o cruzada\npredicoes_cv <- validacao_cruzada(amostra_analise, X1 ~ X6 + X18)\nmatriz_confusao_cv <- table(Predito = predicoes_cv, Real = amostra_analise$X1)\n\nprint(\"Matriz de Classifica√ß√£o - Valida√ß√£o Cruzada:\")\nprint(matriz_confusao_cv)\n\n# Taxa de acerto valida√ß√£o cruzada\nacerto_geral_cv <- sum(diag(matriz_confusao_cv)) / sum(matriz_confusao_cv)\n```\n\n**Taxa de Acerto Geral (Valida√ß√£o Cruzada)**: `r round(acerto_geral_cv * 100, 1)`%\n\n#### 6.8 Valida√ß√£o Externa\n\n```{r}\n# Classifica√ß√£o da amostra de valida√ß√£o\npredicoes_validacao <- predict(modelo_final, amostra_validacao)\nmatriz_confusao_validacao <- table(Predito = predicoes_validacao$class, \n                                  Real = amostra_validacao$X1)\n\nprint(\"Matriz de Classifica√ß√£o - Amostra de Valida√ß√£o:\")\nprint(matriz_confusao_validacao)\n\n# Taxa de acerto amostra de valida√ß√£o\nacerto_geral_validacao <- sum(diag(matriz_confusao_validacao)) / sum(matriz_confusao_validacao)\n\n# Taxa de acerto por grupo\nacerto_por_grupo_validacao <- diag(matriz_confusao_validacao) / rowSums(matriz_confusao_validacao)\nprint(\"Taxa de Acerto por Grupo (Valida√ß√£o):\")\nprint(round(acerto_por_grupo_validacao * 100, 1))\n```\n\n**Taxa de Acerto Geral (Valida√ß√£o)**: `r round(acerto_geral_validacao * 100, 1)`%\n\n#### 6.9 Crit√©rios de Chance\n\n```{r}\n# Calculando crit√©rios de chance\ntamanhos_grupos <- table(amostra_analise$X1)\nproporcoes_grupos <- tamanhos_grupos / sum(tamanhos_grupos)\n\n# Crit√©rio de chance proporcional\ncriterio_chance_proporcional <- sum(proporcoes_grupos^2) * 100\n\n# Crit√©rio de chance m√°xima\ncriterio_chance_maxima <- max(proporcoes_grupos) * 100\n\n# Gr√°fico de compara√ß√£o das taxas de acerto\ntaxas_acerto <- data.frame(\n  Metodo = c(\"An√°lise\", \"Valida√ß√£o Cruzada\", \"Valida√ß√£o Externa\", \n             \"Crit√©rio Proporcional\", \"Crit√©rio M√°ximo\"),\n  Taxa = c(acerto_geral_analise * 100, \n           acerto_geral_cv * 100,\n           acerto_geral_validacao * 100,\n           criterio_chance_proporcional,\n           criterio_chance_maxima),\n  Tipo = c(\"Modelo\", \"Modelo\", \"Modelo\", \"Refer√™ncia\", \"Refer√™ncia\")\n)\n\np_performance <- ggplot2::ggplot(taxas_acerto, ggplot2::aes(x = reorder(Metodo, Taxa), y = Taxa, fill = Tipo)) +\n  ggplot2::geom_col(alpha = 0.8, width = 0.7) +\n  ggplot2::geom_text(ggplot2::aes(label = paste0(round(Taxa, 1), \"%\")), \n                     hjust = -0.1, size = 4, fontface = \"bold\") +\n  ggplot2::coord_flip() +\n  ggplot2::scale_fill_manual(values = c(\"Modelo\" = \"steelblue\", \"Refer√™ncia\" = \"coral\")) +\n  ggplot2::labs(title = \"Compara√ß√£o das Taxas de Acerto\",\n                subtitle = \"Modelo vs. Crit√©rios de Chance\",\n                x = \"M√©todo de Valida√ß√£o\", \n                y = \"Taxa de Acerto (%)\",\n                fill = \"Tipo\") +\n  ggplot2::theme_minimal() +\n  ggplot2::theme(legend.position = \"bottom\",\n                 plot.title = ggplot2::element_text(size = 14, face = \"bold\"))\n\nprint(p_performance)\n```\n\n**Crit√©rios de Chance:**\n\n- **Crit√©rio de Chance Proporcional**: `r round(criterio_chance_proporcional, 1)`%\n- **Crit√©rio de Chance M√°xima**: `r round(criterio_chance_maxima, 1)`%\n\n**Compara√ß√£o com Resultados Obtidos:**\n\n- Taxa de Acerto An√°lise: `r round(acerto_geral_analise * 100, 1)`% vs Crit√©rio Proporcional: `r round(criterio_chance_proporcional, 1)`%\n- Taxa de Acerto Valida√ß√£o Cruzada: `r round(acerto_geral_cv * 100, 1)`% vs Crit√©rio Proporcional: `r round(criterio_chance_proporcional, 1)`%  \n- Taxa de Acerto Valida√ß√£o: `r round(acerto_geral_validacao * 100, 1)`% vs Crit√©rio Proporcional: `r round(criterio_chance_proporcional, 1)`%\n\n### Resumo da Interpreta√ß√£o Gerencial\n\nOs resultados da an√°lise discriminante revelam insights importantes sobre a diferencia√ß√£o de clientes baseada no tempo de relacionamento. Com o dataset completo analisado, identificamos que de 13 vari√°veis independentes testadas, apenas 2 foram suficientes para uma discrimina√ß√£o efetiva.\n\n#### Principais Descobertas:\n\n1. **Vari√°veis Discriminantes**: X6 (Product Quality) e X18 (Delivery Speed) s√£o os principais diferenciadores, representando aproximadamente 100% da vari√¢ncia discriminante total.\n\n2. **Precis√£o do Modelo**: O modelo alcan√ßa alta taxa de acertos na amostra de an√°lise, superando significativamente os crit√©rios de chance.\n\n3. **Diferen√ßas entre Grupos**: \n   - **Clientes novos** (< 1 ano): Menores percep√ß√µes de qualidade e velocidade\n   - **Clientes intermedi√°rios** (1-5 anos): Percep√ß√µes moderadas\n   - **Clientes estabelecidos** (> 5 anos): Maiores percep√ß√µes de qualidade e velocidade\n\n#### Implica√ß√µes Gerenciais:\n\n- **Foco na Qualidade**: Investir na melhoria da qualidade do produto √© fundamental para reter clientes\n- **Otimiza√ß√£o de Entregas**: A velocidade de entrega √© um diferencial competitivo cr√≠tico\n- **Segmenta√ß√£o**: Os 3 grupos identificados requerem estrat√©gias diferenciadas\n\n```{r}\n# M√©dias dos grupos para interpreta√ß√£o\nmedias_grupos <- aggregate(amostra_analise[, variaveis_independentes], \n                          by = list(amostra_analise$X1), FUN = mean)\nnames(medias_grupos)[1] <- \"Grupo\"\n\n# Corrigindo erro na impress√£o das m√©dias dos grupos\nmedias_grupos_numericas <- medias_grupos[, -1]  # Remove coluna 'Grupo'\nrownames(medias_grupos_numericas) <- medias_grupos$Grupo\n\nprint(\"M√©dias dos Grupos nas Vari√°veis Independentes:\")\nprint(round(medias_grupos_numericas, 2))\n\ncat(\"\\n=== INTERPRETA√á√ÉO DAS FUN√á√ïES DISCRIMINANTES ===\\n\")\ncat(\"Fun√ß√£o 1: Diferencia principalmente entre Grupo 1 e Grupos 2-3\\n\")\ncat(\"Fun√ß√£o 2: Diferencia principalmente entre Grupo 3 e Grupos 1-2\\n\")\n\ncat(\"\\n=== VARI√ÅVEIS MAIS IMPORTANTES ===\\n\")\nif(exists(\"indice_potencia_ordenado\")) {\n  cat(\"Por √çndice de Pot√™ncia:\\n\")\n  print(names(indice_potencia_ordenado)[1:min(5, length(indice_potencia_ordenado))])\n}\n\ncat(\"\\nPor Raz√£o F Univariada:\\n\")\nprint(names(razoes_f_ordenadas)[1:min(5, length(razoes_f_ordenadas))])\n\ncat(\"\\n=== RESUMO FINAL ===\\n\")\ncat(\"Modelo discriminante final: X1 ~ X6 + X18\\n\")\ncat(\"Vari√°veis selecionadas:\\n\")\ncat(\"- X6: Qualidade do produto\\n\")\ncat(\"- X18: Velocidade de entrega\\n\")\n\nif(exists(\"modelo_stepwise\")) {\n  cat(\"\\nVari√°veis selecionadas pelo procedimento stepwise:\\n\")\n  print(modelo_stepwise$formula)\n}\n\ncat(\"\\n=== CONCLUS√ïES GERENCIAIS ===\\n\")\ncat(\"1. A qualidade do produto (X6) e velocidade de entrega (X18) s√£o os principais diferenciadores entre os grupos de clientes.\\n\")\ncat(\"2. O modelo consegue discriminar bem entre os tr√™s grupos de tempo de relacionamento.\\n\")\ncat(\"3. Clientes de longo prazo valorizam mais qualidade e velocidade de entrega.\\n\")\ncat(\"4. A√ß√µes de melhoria devem focar nestas duas dimens√µes para reter clientes.\\n\")\n```\n\n**An√°lise das M√©dias por Grupo:**\n\nOs resultados mostram um padr√£o claro de evolu√ß√£o das percep√ß√µes com o tempo de relacionamento, com melhorias progressivas nas percep√ß√µes de qualidade e velocidade de entrega conforme aumenta o tempo de relacionamento com a empresa.\n\n### Ap√™ndice: Informa√ß√µes T√©cnicas do Dataset\n\n#### Caracter√≠sticas do Dataset HBAT\n\n```{r}\n# Informa√ß√µes sobre o dataset ap√≥s limpeza\ncat(\"=== CARACTER√çSTICAS DO DATASET FINAL ===\\n\")\ncat(\"Total de observa√ß√µes:\", nrow(hbat_clean), \"\\n\")\ncat(\"Vari√°veis independentes analisadas:\", length(variaveis_independentes), \"\\n\")\ncat(\"Grupos da vari√°vel dependente:\", nlevels(hbat_clean$X1), \"\\n\")\n\n# Distribui√ß√£o dos grupos\ndist_grupos <- table(hbat_clean$X1)\nprop_grupos <- prop.table(dist_grupos) * 100\n\ncat(\"\\nDistribui√ß√£o dos grupos:\\n\")\nfor(i in 1:length(dist_grupos)) {\n  cat(\"- \", names(dist_grupos)[i], \": \", dist_grupos[i], \" casos (\", \n      round(prop_grupos[i], 1), \"%)\\n\", sep = \"\")\n}\n```\n\n#### Qualidade dos Dados\n\n- **Missing values**: Removidos atrav√©s de listwise deletion\n- **Balanceamento**: Dataset relativamente balanceado entre os grupos\n- **Escala das vari√°veis**: Todas as vari√°veis independentes est√£o na escala de 0-10\n\n```{r}\n# Informa√ß√µes detalhadas sobre o dataset HBAT\ncat(\"=== INFORMA√á√ïES DO DATASET HBAT ===\\n\")\ncat(\"Total de observa√ß√µes:\", nrow(hbat_clean), \"\\n\")\ncat(\"Vari√°veis independentes:\", length(variaveis_independentes), \"\\n\")\ncat(\"Grupos da vari√°vel dependente:\", nlevels(hbat_clean$X1), \"\\n\")\n\n# Descri√ß√£o das vari√°veis (baseado nos labels originais) - ATUALIZADO\ncat(\"\\n=== DESCRI√á√ÉO COMPLETA DAS VARI√ÅVEIS ===\\n\")\nfor(var in names(descricoes_variaveis)) {\n  cat(var, \"-\", descricoes_variaveis[var], \"\\n\")\n}\n\n# Estat√≠sticas descritivas finais\ncat(\"\\n=== ESTAT√çSTICAS DESCRITIVAS FINAIS ===\\n\")\nprint(summary(hbat_clean))\n```\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"√çndice","toc-title-website":"Nesta p√°gina","related-formats-title":"Outros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fonte","other-links-title":"Outros Links","code-links-title":"Links de c√≥digo","launch-dev-container-title":"Iniciar Dev Container","launch-binder-title":"Iniciar Binder","article-notebook-label":"Caderno de Artigo","notebook-preview-download":"Baixar Caderno","notebook-preview-download-src":"Baixar c√≥digo-fonte","notebook-preview-back":"Voltar ao Artigo","manuscript-meca-bundle":"Arquivo MECA","section-title-abstract":"Resumo","section-title-appendices":"Ap√™ndices","section-title-footnotes":"Notas de rodap√©","section-title-references":"Refer√™ncias","section-title-reuse":"Reuso","section-title-copyright":"Direito autoral","section-title-citation":"Cita√ß√£o","appendix-attribution-cite-as":"Por favor, cite este trabalho como:","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"Visualizar Licen√ßa","title-block-author-single":"Autor","title-block-author-plural":"Autores","title-block-affiliation-single":"Afilia√ß√£o","title-block-affiliation-plural":"Afilia√ß√µes","title-block-published":"Data de Publica√ß√£o","title-block-modified":"Data de Modifica√ß√£o","title-block-keywords":"Palavras-chave","callout-tip-title":"Dica","callout-note-title":"Nota","callout-warning-title":"Aviso","callout-important-title":"Importante","callout-caution-title":"Cuidado","code-summary":"C√≥digo","code-tools-menu-caption":"C√≥digo","code-tools-show-all-code":"Mostrar o c√≥digo","code-tools-hide-all-code":"Esconder o c√≥digo","code-tools-view-source":"Ver o c√≥digo fonte","code-tools-source-code":"C√≥digo fonte","tools-share":"Compartilhar","tools-download":"Baixar","code-line":"Linha","code-lines":"Linhas","copy-button-tooltip":"Copiar para a √°rea de transfer√™ncia","copy-button-tooltip-success":"Copiada","repo-action-links-edit":"Editar essa p√°gina","repo-action-links-source":"Ver o c√≥digo fonte","repo-action-links-issue":"Criar uma issue","back-to-top":"De volta ao topo","search-no-results-text":"Nenhum resultado","search-matching-documents-text":"documentos correspondentes","search-copy-link-title":"Copiar link para a busca","search-hide-matches-text":"Esconder correspond√™ncias adicionais","search-more-match-text":"mais correspond√™ncia neste documento","search-more-matches-text":"mais correspond√™ncias neste documento","search-clear-button-title":"Limpar","search-text-placeholder":"","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Procurar","toggle-section":"Alternar se√ß√£o","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo escuro","toggle-reader-mode":"Alternar modo de leitor","toggle-navigation":"Alternar de navega√ß√£o","crossref-fig-title":"Figura","crossref-tbl-title":"Tabela","crossref-lst-title":"Listagem","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corol√°rio","crossref-prp-title":"Proposi√ß√£o","crossref-cnj-title":"Conjectura","crossref-def-title":"Defini√ß√£o","crossref-exm-title":"Exemplo","crossref-exr-title":"Exerc√≠cio","crossref-ch-prefix":"Cap√≠tulo","crossref-apx-prefix":"Ap√™ndice","crossref-sec-prefix":"Se√ß√£o","crossref-eq-prefix":"Equa√ß√£o","crossref-lof-title":"Lista de Figuras","crossref-lot-title":"Lista de Tabelas","crossref-lol-title":"Lista de Listagens","environment-proof-title":"Comprova√ß√£o","environment-remark-title":"Coment√°rio","environment-solution-title":"Solu√ß√£o","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Padr√£o","listing-page-order-by-date-asc":"Mais antigo","listing-page-order-by-date-desc":"O mais novo","listing-page-order-by-number-desc":"Decrescente","listing-page-order-by-number-asc":"Baixo para alto","listing-page-field-date":"Data","listing-page-field-title":"T√≠tulo","listing-page-field-description":"Descri√ß√£o","listing-page-field-author":"Autor","listing-page-field-filename":"Nome do arquivo","listing-page-field-filemodified":"Modificada","listing-page-field-subtitle":"Legenda","listing-page-field-readingtime":"Tempo de leitura","listing-page-field-wordcount":"Contagem de palavras","listing-page-field-categories":"Categorias","listing-page-minutes-compact":"{0}Min","listing-page-category-all":"Todos","listing-page-no-matches":"Sem itens correspondentes","listing-page-words":"{0} palavras","listing-page-filter":"Filtro","draft":"Rascunho"},"metadata":{"lang":"pt-BR","fig-responsive":true,"quarto-version":"1.6.40","theme":["cosmo","brand"],"title":"AN√ÅLISE DISCRIMINANTE","author":[{"name":"Marcus Antonio Cardoso Ramalho","email":"marcus.ramalho@coppead.ufrj.br","affiliations":[{"name":"COPPEAD - UNIVERSIDADE FEDERAL DO RIO DE JANEIRO","address":"Rua Pascoal Lemme, 355","city":"Rio de Janeiro","state":"RJ","postal-code":"21941-918"}]},{"name":"Claudia Regina da Costa de Souza"},{"name":"Ben Hur Correia"}],"date":"today"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}